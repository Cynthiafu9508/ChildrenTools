<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‰§åœºè§£é”è§„åˆ™æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .phone-container {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 8px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #FFF4E6 0%, #FFF8F0 100%);
            border-radius: 32px;
            overflow: hidden;
            position: relative;
        }

        .status-bar {
            height: 44px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .content {
            padding: 20px;
            height: calc(100% - 44px - 50px);
            overflow-y: auto;
        }

        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .demo-hint {
            font-size: 12px;
            color: #999;
            margin-bottom: 20px;
            padding: 8px 12px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reset-btn {
            padding: 6px 12px;
            background: #FF8C42;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reset-btn:hover {
            background: #FF7A2E;
        }

        .reset-btn:active {
            transform: scale(0.95);
        }

        .episode-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .episode-card {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .episode-card:active {
            transform: scale(0.98);
        }

        .episode-card.completed {
            border-left: 4px solid #4CAF50;
        }

        .episode-card.available {
            border-left: 4px solid #FF8C42;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.2);
        }

        .episode-card.locked {
            opacity: 0.6;
            background: #F5F5F5;
        }

        .episode-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .episode-number {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .episode-card.completed .episode-number {
            background: #4CAF50;
            color: #fff;
        }

        .episode-card.available .episode-number {
            background: linear-gradient(135deg, #FF8C42 0%, #FFA366 100%);
            color: #fff;
        }

        .episode-card.locked .episode-number {
            background: #E0E0E0;
            color: #999;
        }

        .episode-info {
            flex: 1;
            min-width: 0;
        }

        .episode-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .episode-card.locked .episode-title {
            color: #999;
        }

        .episode-task {
            font-size: 13px;
            color: #666;
        }

        .episode-card.locked .episode-task {
            color: #999;
        }

        .episode-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .progress-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-count {
            font-size: 12px;
            font-weight: 600;
            color: #FF8C42;
        }

        .progress-bar-container {
            height: 6px;
            background: #E5E5E5;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF8C42 0%, #FFA366 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .time-remaining {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }

        .update-card {
            background: linear-gradient(135deg, #FFE5CC 0%, #FFF0E0 100%);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 2px 10px rgba(74, 144, 226, 0.1);
            border: 2px dashed #FF8C42;
            min-height: 120px;
        }

        .update-card-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .update-card-title {
            font-size: 16px;
            font-weight: 500;
            color: #FF8C42;
            margin-bottom: 6px;
        }

        .update-card-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .nav-bar {
            height: 50px;
            background: #fff;
            border-top: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px 0;
            color: #999;
            cursor: pointer;
        }

        .nav-item.active {
            color: #FF8C42;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
            background: currentColor;
            border-radius: 4px;
        }

        .nav-text {
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="screen">
            <div class="status-bar">
                <span>9:41</span>
                <span>ğŸ”‹ 100%</span>
            </div>
            
            <div class="content">
                <div class="page-title">å‰§åœº</div>
                
                <div class="demo-hint">
                    <span>ğŸ’¡ æç¤ºï¼šæŒ‰ <strong>C</strong> é”®å¯å¢åŠ æ²Ÿé€šè½®æ¬¡ï¼ŒæŒ‰ <strong>D</strong> é”®å¯å¢åŠ 24å°æ—¶</span>
                    <button class="reset-btn" onclick="resetDemo()">é‡ç½®æ¼”ç¤º</button>
                </div>

                <div class="episode-list" id="episodeList">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="nav-bar">
                <div class="nav-item" onclick="window.location.href='pairing-set.html'">
                    <div class="nav-icon"></div>
                    <div class="nav-text">ä¼™ä¼´</div>
                </div>
                <div class="nav-item active">
                    <div class="nav-icon"></div>
                    <div class="nav-text">å‰§åœº</div>
                </div>
                <div class="nav-item" onclick="window.location.href='growth.html'">
                    <div class="nav-icon"></div>
                    <div class="nav-text">æˆé•¿</div>
                </div>
                <div class="nav-item" onclick="window.location.href='mine.html'">
                    <div class="nav-icon"></div>
                    <div class="nav-text">æˆ‘çš„</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        
        const episodes = [
            { id: 1, title: 'ä¸æ˜Ÿå®ç›¸è¯†', task: 'ä»»åŠ¡è¯´æ˜ï¼šç”¨è‹±æ–‡åšè‡ªæˆ‘ä»‹ç»ï¼ŒåŒ…å«"my,name,like"ç­‰é«˜é¢‘ä¸»é¢˜è¯ã€‚' },
            { id: 2, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 3, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 4, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 5, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 6, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 7, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' }
        ];

        // ä» localStorage æ¢å¤çŠ¶æ€
        function loadDemoState() {
            try {
                const savedPlayed = localStorage.getItem('theaterDemoPlayedEpisodes');
                const savedUnlocked = localStorage.getItem('theaterDemoUnlockedEpisodes');
                const savedRounds = localStorage.getItem('theaterDemoCommunicationRounds');
                const savedTimes = localStorage.getItem('theaterDemoCompleteTimes');
                
                return {
                    playedEpisodes: savedPlayed ? JSON.parse(savedPlayed) : [],
                    unlockedEpisodes: savedUnlocked ? JSON.parse(savedUnlocked) : [],
                    communicationRounds: savedRounds ? parseInt(savedRounds) || 0 : 0,
                    episodeCompleteTimes: savedTimes ? JSON.parse(savedTimes) : {}
                };
            } catch (error) {
                console.error('Error loading demo state:', error);
                return {
                    playedEpisodes: [],
                    unlockedEpisodes: [],
                    communicationRounds: 0,
                    episodeCompleteTimes: {}
                };
            }
        }

        // ä¿å­˜çŠ¶æ€åˆ° localStorage
        function saveDemoState() {
            try {
                localStorage.setItem('theaterDemoPlayedEpisodes', JSON.stringify(demoState.playedEpisodes));
                localStorage.setItem('theaterDemoUnlockedEpisodes', JSON.stringify(demoState.unlockedEpisodes));
                localStorage.setItem('theaterDemoCommunicationRounds', demoState.communicationRounds.toString());
                localStorage.setItem('theaterDemoCompleteTimes', JSON.stringify(demoState.episodeCompleteTimes));
            } catch (error) {
                console.error('Error saving demo state:', error);
            }
        }

        let demoState = loadDemoState();

        // é‡ç½®æ¼”ç¤ºçŠ¶æ€
        function resetDemo() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ¼”ç¤ºå—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰è¿›åº¦ï¼Œä»ç¬¬ä¸€é›†é‡æ–°å¼€å§‹ã€‚')) {
                // æ¸…é™¤æ‰€æœ‰ç›¸å…³çš„ localStorage æ•°æ®
                localStorage.removeItem('theaterDemoPlayedEpisodes');
                localStorage.removeItem('theaterDemoUnlockedEpisodes');
                localStorage.removeItem('theaterDemoCommunicationRounds');
                localStorage.removeItem('theaterDemoCompleteTimes');
                
                // é‡ç½®çŠ¶æ€
                demoState = {
                    playedEpisodes: [],
                    unlockedEpisodes: [],
                    communicationRounds: 0,
                    episodeCompleteTimes: {}
                };
                
                // é‡æ–°æ¸²æŸ“é¡µé¢
                renderEpisodes();
                alert('æ¼”ç¤ºå·²é‡ç½®ï¼Œå¯ä»¥ä»ç¬¬ä¸€é›†é‡æ–°å¼€å§‹ï¼');
            }
        }

        function initPage() {
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²æ»¡è¶³è§£é”æ¡ä»¶çš„é›†æ•°
            tryUnlockByRounds();
            renderEpisodes();
        }

        function renderEpisodes() {
            try {
                const episodeList = document.getElementById('episodeList');
                if (!episodeList) {
                    console.error('episodeList element not found');
                    return;
                }

                if (!episodes || !Array.isArray(episodes) || episodes.length === 0) {
                    console.error('Episodes data not available', episodes);
                    episodeList.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">æš‚æ— å‰§é›†æ•°æ®</div>';
                    return;
                }

                let episodesHtml = '';

                episodes.forEach((episode, index) => {
                const episodeId = episode.id;
                const isPlayed = demoState.playedEpisodes.includes(episodeId);
                const isUnlocked = checkEpisodeUnlocked(episodeId);
                const isAvailable = isUnlocked || isPlayed;
                const isLocked = !isAvailable;

                let statusClass = 'locked';
                let statusIcon = 'ğŸ”’';

                if (isPlayed) {
                    statusClass = 'completed';
                    statusIcon = 'âœ“';
                } else if (isAvailable) {
                    statusClass = 'available';
                    statusIcon = 'â–¶';
                }

                let progressHtml = '';
                // æ ¹æ®å½“å‰çŠ¶æ€è‡ªåŠ¨åˆ¤æ–­æ˜¾ç¤ºå“ªä¸ªé›†æ•°çš„è¿›åº¦æ¡
                // åªæ˜¾ç¤ºæœªæ’­æ”¾ä¸”æœªè§£é”é›†æ•°çš„è¿›åº¦æ¡
                // å·²æ’­æ”¾çš„é›†æ•°ç»å¯¹ä¸æ˜¾ç¤ºè¿›åº¦æ¡
                if (!isPlayed) {
                    // åªå¤„ç†æœªæ’­æ”¾çš„é›†æ•°
                    // ç¬¬äºŒé›†ï¼šç¬¬ä¸€é›†å·²æ’­æ”¾ï¼Œä½†ç¬¬äºŒé›†æœªæ’­æ”¾ä¸”æœªè§£é”ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡
                    // æ³¨æ„ï¼šå¦‚æœç¬¬äºŒé›†å·²æ’­æ”¾ï¼Œè¿›åº¦æ¡åº”è¯¥è½¬ç§»åˆ°ç¬¬ä¸‰é›†
                    if (episodeId === 2 && !isUnlocked && demoState.playedEpisodes.includes(1) && !demoState.playedEpisodes.includes(2)) {
                        const rounds = demoState.communicationRounds;
                        const required = 3;
                        const percent = Math.min(100, (rounds / required) * 100);
                        progressHtml = `
                            <div class="progress-section">
                                <div class="progress-label">
                                    <span>ä¸ç©å¶æ²Ÿé€šè¿›åº¦</span>
                                    <span class="progress-count">${rounds}/${required}è½®æ¬¡</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style="width: ${percent}%"></div>
                                </div>
                            </div>
                        `;
                    } else if (episodeId === 3 && !isUnlocked &&
                              demoState.playedEpisodes.includes(1) &&
                              demoState.playedEpisodes.includes(2)) {
                        // ç¬¬ä¸‰é›†ï¼šç¬¬ä¸€ã€äºŒé›†å·²æ’­æ”¾ï¼Œä½†ç¬¬ä¸‰é›†æœªæ’­æ”¾ä¸”æœªè§£é”ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡ï¼ˆç¬¬äºŒé›†çš„è¿›åº¦æ¡æ¶ˆå¤±ï¼‰
                        const rounds = demoState.communicationRounds;
                        const required = 5;
                        const percent = Math.min(100, (rounds / required) * 100);
                        progressHtml = `
                            <div class="progress-section">
                                <div class="progress-label">
                                    <span>ä¸ç©å¶æ²Ÿé€šè¿›åº¦</span>
                                    <span class="progress-count">${rounds}/${required}è½®æ¬¡</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style="width: ${percent}%"></div>
                                </div>
                            </div>
                        `;
                    } else if (episodeId >= 4 && !isUnlocked &&
                              demoState.playedEpisodes.includes(episodeId - 1)) {
                        // ç¬¬å››é›†åŠä»¥åï¼šä¸Šä¸€é›†å·²æ’­æ”¾ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡å’Œæ—¶é—´
                        const rounds = demoState.communicationRounds;
                        const required = 5;
                        const percent = Math.min(100, (rounds / required) * 100);
                        const progressText = rounds >= required ? 'æ²Ÿé€šè¿›åº¦å®Œæˆ' : `${rounds}/${required}è½®æ¬¡`;
                        
                        let timeHtml = '';
                        // ç¬¬å››é›†åŠä»¥åéƒ½éœ€è¦æ˜¾ç¤º24å°æ—¶ç­‰å¾…ä¿¡æ¯
                        if (episodeId >= 4) {
                            const prevEpisode = episodeId - 1;
                            const prevCompleteTime = demoState.episodeCompleteTimes[prevEpisode];
                            if (prevCompleteTime) {
                                const now = Date.now();
                                const hoursPassed = (now - prevCompleteTime) / (1000 * 60 * 60);
                                const hoursRemaining = Math.max(0, 24 - hoursPassed);
                                
                                if (hoursRemaining > 0) {
                                    const hours = Math.floor(hoursRemaining);
                                    const minutes = Math.floor((hoursRemaining - hours) * 60);
                                    timeHtml = `<div class="time-remaining">â° è¿˜éœ€ç­‰å¾…ï¼š${hours}å°æ—¶${minutes}åˆ†é’Ÿ</div>`;
                                } else {
                                    timeHtml = `<div class="time-remaining" style="color: #4CAF50;">âœ“ 24å°æ—¶é—´éš”å·²å®Œæˆ</div>`;
                                }
                            }
                        }
                        
                        progressHtml = `
                            <div class="progress-section">
                                <div class="progress-label">
                                <span>ä¸ç©å¶æ²Ÿé€šè¿›åº¦</span>
                                <span class="progress-count">${progressText}</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style="width: ${percent}%"></div>
                                </div>
                                ${timeHtml}
                            </div>
                        `;
                    }
                }

                episodesHtml += `
                    <div class="episode-card ${statusClass}" onclick="handleEpisodeClick(${episodeId}, ${isLocked})">
                        <div class="episode-header">
                            <div class="episode-number">${episodeId}</div>
                            <div class="episode-info">
                                <div class="episode-title">ç¬¬${episodeId}é›†ï¼š${episode.title}</div>
                                <div class="episode-task">${episode.task}</div>
                            </div>
                            <div class="episode-icon">${statusIcon}</div>
                        </div>
                        ${progressHtml}
                    </div>
                `;
                });

                const updateCardHtml = `
                    <div class="update-card">
                        <div class="update-card-icon">ğŸ¬</div>
                        <div class="update-card-title">æ›´å¤šç²¾å½©å‰§é›†å³å°†ä¸Šçº¿</div>
                        <div class="update-card-desc">å‰§åœºæŒç»­æ›´æ–°ä¸­ï¼Œæ•¬è¯·æœŸå¾…</div>
                    </div>
                `;

                episodeList.innerHTML = episodesHtml + updateCardHtml;
            } catch (error) {
                console.error('Error in renderEpisodes:', error);
            }
        }

        function checkEpisodeUnlocked(episodeId) {
            // å·²æ’­æ”¾çš„é›†æ•°è§†ä¸ºå·²è§£é”
            if (demoState.playedEpisodes.includes(episodeId)) {
                return true;
            }

            // å·²è§£é”çš„é›†æ•°è§†ä¸ºå·²è§£é”
            if (demoState.unlockedEpisodes.includes(episodeId)) {
                return true;
            }

            if (episodeId === 1) {
                return true; // ç¬¬ä¸€é›†æ€»æ˜¯è§£é”
            }

            if (episodeId === 2) {
                // ç¬¬äºŒé›†ï¼šéœ€è¦ç¬¬ä¸€é›†æ’­æ”¾ + æ²Ÿé€š3è½®æ¬¡
                if (demoState.playedEpisodes.includes(1) && demoState.communicationRounds >= 3) {
                    // å¦‚æœæ»¡è¶³æ¡ä»¶ä½†è¿˜æ²¡æ·»åŠ åˆ° unlockedEpisodesï¼Œåˆ™æ·»åŠ 
                    if (!demoState.unlockedEpisodes.includes(2)) {
                        demoState.unlockedEpisodes.push(2);
                        saveDemoState();
                    }
                    return true;
                }
                return false;
            }

            if (episodeId === 3) {
                // ç¬¬ä¸‰é›†ï¼šéœ€è¦ç¬¬ä¸€ã€äºŒé›†æ’­æ”¾ + æ²Ÿé€š5è½®æ¬¡
                if (demoState.playedEpisodes.includes(1) &&
                    demoState.playedEpisodes.includes(2) &&
                    demoState.communicationRounds >= 5) {
                    // å¦‚æœæ»¡è¶³æ¡ä»¶ä½†è¿˜æ²¡æ·»åŠ åˆ° unlockedEpisodesï¼Œåˆ™æ·»åŠ 
                    if (!demoState.unlockedEpisodes.includes(3)) {
                        demoState.unlockedEpisodes.push(3);
                        saveDemoState();
                    }
                    return true;
                }
                return false;
            }

            if (episodeId === 4) {
                // ç¬¬å››é›†ï¼šéœ€è¦ç¬¬ä¸‰é›†å·²æ’­æ”¾ + æ²Ÿé€š5è½®æ¬¡ + 24å°æ—¶
                const prevEpisode = episodeId - 1;
                if (!demoState.playedEpisodes.includes(prevEpisode)) {
                    return false;
                }
                if (demoState.communicationRounds < 5) {
                    return false;
                }
                const prevCompleteTime = demoState.episodeCompleteTimes[prevEpisode];
                if (!prevCompleteTime) {
                    return false;
                }
                const now = Date.now();
                const hoursPassed = (now - prevCompleteTime) / (1000 * 60 * 60);
                return hoursPassed >= 24;
            }

            if (episodeId >= 5) {
                // ç¬¬äº”é›†åŠä»¥åï¼šéœ€è¦ä¸Šä¸€é›†æ’­æ”¾ + æ²Ÿé€š5è½®æ¬¡ + 24å°æ—¶
                const prevEpisode = episodeId - 1;
                if (!demoState.playedEpisodes.includes(prevEpisode)) {
                    return false;
                }
                if (demoState.communicationRounds < 5) {
                    return false;
                }
                const prevCompleteTime = demoState.episodeCompleteTimes[prevEpisode];
                if (!prevCompleteTime) {
                    return false;
                }
                const now = Date.now();
                const hoursPassed = (now - prevCompleteTime) / (1000 * 60 * 60);
                return hoursPassed >= 24;
            }

            return false;
        }

        function handleEpisodeClick(episodeId, isLocked) {
            // é‡æ–°æ£€æŸ¥è§£é”çŠ¶æ€ï¼ˆé˜²æ­¢çŠ¶æ€ä¸åŒæ­¥ï¼‰
            const isPlayed = demoState.playedEpisodes.includes(episodeId);
            const isUnlocked = checkEpisodeUnlocked(episodeId);
            const isActuallyLocked = !(isUnlocked || isPlayed);
            
            if (isActuallyLocked) {
                showUnlockInfo(episodeId);
                return;
            }

            // æ ‡è®°ä¸ºå·²æ’­æ”¾
            if (!demoState.playedEpisodes.includes(episodeId)) {
                demoState.playedEpisodes.push(episodeId);
                // è®°å½•å®Œæˆæ—¶é—´ï¼ˆç”¨äº24å°æ—¶è®¡æ—¶ï¼‰
                demoState.episodeCompleteTimes[episodeId] = Date.now();
                // ä¿å­˜çŠ¶æ€
                saveDemoState();
            }
            
            // è·³è½¬åˆ°è§†é¢‘æ’­æ”¾é¡µé¢
            window.location.href = `video-player.html?episode=${episodeId}`;
        }

        function showUnlockInfo(episodeId) {
            let message = '';
            const requirements = [];
            
            if (episodeId === 1) {
                message = 'ç¬¬1é›†å¯ä»¥ç›´æ¥æ’­æ”¾';
            } else if (episodeId === 2) {
                const hasPlayed1 = demoState.playedEpisodes.includes(1);
                const rounds = demoState.communicationRounds;
                
                if (!hasPlayed1) {
                    requirements.push('æ’­æ”¾ç¬¬1é›†');
                }
                if (rounds < 3 && !demoState.unlockedEpisodes.includes(2)) {
                    requirements.push(`ä¸ç©å¶æ²Ÿé€š3è½®æ¬¡ï¼ˆå½“å‰ï¼š${rounds}/3ï¼‰`);
                }
                
                if (requirements.length > 0) {
                    message = `è§£é”ç¬¬2é›†éœ€è¦ï¼š\n${requirements.map((req, index) => `${index + 1}. ${req}`).join('\n')}`;
                } else {
                    message = 'ç¬¬2é›†å·²æ»¡è¶³æ‰€æœ‰è§£é”æ¡ä»¶ï¼Œå¯ä»¥æ’­æ”¾äº†ï¼';
                }
            } else if (episodeId === 3) {
                const hasPlayed1 = demoState.playedEpisodes.includes(1);
                const hasPlayed2 = demoState.playedEpisodes.includes(2);
                const rounds = demoState.communicationRounds;
                
                if (!hasPlayed1) {
                    requirements.push('æ’­æ”¾ç¬¬1é›†');
                }
                if (!hasPlayed2) {
                    requirements.push('æ’­æ”¾ç¬¬2é›†');
                }
                if (rounds < 5 && !demoState.unlockedEpisodes.includes(3)) {
                    requirements.push(`ä¸ç©å¶æ²Ÿé€š5è½®æ¬¡ï¼ˆå½“å‰ï¼š${rounds}/5ï¼‰`);
                }
                
                if (requirements.length > 0) {
                    message = `è§£é”ç¬¬3é›†éœ€è¦ï¼š\n${requirements.map((req, index) => `${index + 1}. ${req}`).join('\n')}`;
                } else {
                    message = 'ç¬¬3é›†å·²æ»¡è¶³æ‰€æœ‰è§£é”æ¡ä»¶ï¼Œå¯ä»¥æ’­æ”¾äº†ï¼';
                }
            } else if (episodeId >= 4) {
                const prevEpisode = episodeId - 1;
                const hasPlayedPrev = demoState.playedEpisodes.includes(prevEpisode);
                const rounds = demoState.communicationRounds;
                const prevCompleteTime = demoState.episodeCompleteTimes[prevEpisode];
                
                if (!hasPlayedPrev) {
                    requirements.push(`æ’­æ”¾ç¬¬${prevEpisode}é›†`);
                }
                if (rounds < 5 && !demoState.unlockedEpisodes.includes(episodeId)) {
                    requirements.push(`ä¸ç©å¶æ²Ÿé€š5è½®æ¬¡ï¼ˆå½“å‰ï¼š${rounds}/5ï¼‰`);
                }

                // ç¬¬å››é›†åŠä»¥åéƒ½éœ€è¦24å°æ—¶é™åˆ¶
                let hoursRemaining = 0;
                if (prevCompleteTime) {
                    const now = Date.now();
                    const hoursPassed = (now - prevCompleteTime) / (1000 * 60 * 60);
                    hoursRemaining = Math.max(0, 24 - hoursPassed);
                    if (hoursRemaining > 0) {
                        const hours = Math.floor(hoursRemaining);
                        const minutes = Math.floor((hoursRemaining - hours) * 60);
                        requirements.push(`è·ç¦»æ’­æ”¾ç¬¬${prevEpisode}é›†é—´éš”24å°æ—¶ï¼ˆè¿˜éœ€ç­‰å¾…ï¼š${hours}å°æ—¶${minutes}åˆ†é’Ÿï¼‰`);
                    }
                } else if (hasPlayedPrev) {
                    requirements.push(`è·ç¦»æ’­æ”¾ç¬¬${prevEpisode}é›†é—´éš”24å°æ—¶`);
                }
                
                if (requirements.length > 0) {
                    message = `è§£é”ç¬¬${episodeId}é›†éœ€è¦ï¼š\n${requirements.map((req, index) => `${index + 1}. ${req}`).join('\n')}`;
                } else {
                    message = `ç¬¬${episodeId}é›†å·²æ»¡è¶³æ‰€æœ‰è§£é”æ¡ä»¶ï¼Œå¯ä»¥æ’­æ”¾äº†ï¼`;
                }
            }
            
            alert(message);
        }

        // æ¨¡æ‹Ÿå¢åŠ æ²Ÿé€šè½®æ¬¡ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
        function addCommunicationRound() {
            demoState.communicationRounds++;
            tryUnlockByRounds();
            saveDemoState();
            renderEpisodes();
        }

        function tryUnlockByRounds() {
            // ç¬¬äºŒé›†è§£é”ï¼šç¬¬ä¸€é›†å·²æ’­æ”¾ + æ²Ÿé€š3è½®æ¬¡
            if (!demoState.unlockedEpisodes.includes(2) && demoState.playedEpisodes.includes(1) && demoState.communicationRounds >= 3) {
                demoState.unlockedEpisodes.push(2);
                demoState.communicationRounds = 0;
                saveDemoState();
                return;
            }

            // ç¬¬ä¸‰é›†è§£é”ï¼šç¬¬ä¸€ã€äºŒé›†å·²æ’­æ”¾ + æ²Ÿé€š5è½®æ¬¡
            if (!demoState.unlockedEpisodes.includes(3) &&
                demoState.playedEpisodes.includes(1) &&
                demoState.playedEpisodes.includes(2) &&
                demoState.communicationRounds >= 5) {
                demoState.unlockedEpisodes.push(3);
                demoState.communicationRounds = 0;
                saveDemoState();
                return;
            }

            // ç¬¬å››é›†è§£é”ï¼šç¬¬ä¸‰é›†å·²æ’­æ”¾ + æ²Ÿé€š5è½®æ¬¡ + 24å°æ—¶
            if (!demoState.unlockedEpisodes.includes(4) &&
                demoState.playedEpisodes.includes(3) &&
                demoState.communicationRounds >= 5) {
                const prevCompleteTime = demoState.episodeCompleteTimes[3];
                if (prevCompleteTime) {
                    const now = Date.now();
                    const hoursPassed = (now - prevCompleteTime) / (1000 * 60 * 60);
                    if (hoursPassed >= 24) {
                        demoState.unlockedEpisodes.push(4);
                        demoState.communicationRounds = 0;
                        saveDemoState();
                        return;
                    }
                }
            }

            // ç¬¬äº”é›†åŠä»¥åï¼šä¸Šä¸€é›†å·²æ’­æ”¾ + æ²Ÿé€š5è½®æ¬¡ + 24å°æ—¶
            for (let episodeId = 5; episodeId <= 7; episodeId++) {
                if (demoState.unlockedEpisodes.includes(episodeId)) {
                    continue;
                }
                const prevEpisode = episodeId - 1;
                if (demoState.playedEpisodes.includes(prevEpisode) && demoState.communicationRounds >= 5) {
                    const prevCompleteTime = demoState.episodeCompleteTimes[prevEpisode];
                    if (prevCompleteTime) {
                        const now = Date.now();
                        const hoursPassed = (now - prevCompleteTime) / (1000 * 60 * 60);
                        if (hoursPassed >= 24) {
                            demoState.unlockedEpisodes.push(episodeId);
                            demoState.communicationRounds = 0;
                            saveDemoState();
                            return;
                        }
                    }
                }
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        function initialize() {
            if (document.readyState === 'loading') {
                window.addEventListener('DOMContentLoaded', function() {
                    initPage();
                });
            } else {
                initPage();
            }
        }
        
        // ç«‹å³å°è¯•åˆå§‹åŒ–
        initialize();
        
        // é¡µé¢æ˜¾ç¤ºæ—¶åˆ·æ–°ï¼ˆä»è§†é¢‘æ’­æ”¾é¡µé¢è¿”å›æ—¶ï¼‰
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // é‡æ–°åŠ è½½çŠ¶æ€
                demoState = loadDemoState();
                renderEpisodes();
            }
        });
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®ç”¨äºæ¼”ç¤ºï¼ˆå…¨å±€ç›‘å¬ï¼‰
        document.addEventListener('keydown', function(e) {
            // å¦‚æœä¸åœ¨è¾“å…¥æ¡†ä¸­
            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                // æŒ‰ C é”®å¢åŠ æ²Ÿé€šè½®æ¬¡
                if (e.key === 'c' || e.key === 'C') {
                    e.preventDefault();
                    addCommunicationRound();
                }
                // æŒ‰ D é”®å¢åŠ 24å°æ—¶
                if (e.key === 'd' || e.key === 'D') {
                    e.preventDefault();
                    add24Hours();
                }
            }
        });
        
        // æ¨¡æ‹Ÿå¢åŠ 24å°æ—¶ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
        function add24Hours() {
            // å°†æ‰€æœ‰å·²å®Œæˆé›†æ•°çš„å®Œæˆæ—¶é—´å¾€å‰æ¨24å°æ—¶
            let hasChanges = false;
            for (let episodeId in demoState.episodeCompleteTimes) {
                demoState.episodeCompleteTimes[episodeId] -= 24 * 60 * 60 * 1000;
                hasChanges = true;
            }
            
            if (hasChanges) {
                saveDemoState();
                renderEpisodes();
                
                // æ˜¾ç¤ºæç¤º
                const hintElement = document.querySelector('.demo-hint span');
                const originalText = hintElement.textContent;
                hintElement.textContent = 'â° å·²å¢åŠ 24å°æ—¶ï¼';
                hintElement.style.color = '#4CAF50';
                setTimeout(() => {
                    hintElement.textContent = originalText;
                    hintElement.style.color = '';
                }, 1500);
            } else {
                // æ²¡æœ‰å·²å®Œæˆçš„é›†æ•°
                const hintElement = document.querySelector('.demo-hint span');
                const originalText = hintElement.textContent;
                hintElement.textContent = 'âš ï¸ æš‚æ— éœ€è¦ç­‰å¾…çš„é›†æ•°';
                hintElement.style.color = '#FF9800';
                setTimeout(() => {
                    hintElement.textContent = originalText;
                    hintElement.style.color = '';
                }, 1500);
            }
        }
    </script>
</body>
</html>
