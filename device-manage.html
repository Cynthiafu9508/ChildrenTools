<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ËÆæÂ§áÁÆ°ÁêÜ - AIÁé©ÂÖ∑Â∞èÁ®ãÂ∫è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .phone-container {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 8px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #1a1a2e 0%, #000 100%);
            border-radius: 32px;
            overflow: hidden;
            position: relative;
        }

        .status-bar {
            height: 44px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        .header {
            height: 44px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            color: #fff;
            position: relative;
        }

        .back-button {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
        }

        .header-title {
            flex: 1;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
        }

        .header-right {
            position: absolute;
            right: 20px;
        }

        .switch-device-btn {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #fff;
            cursor: pointer;
            transition: background 0.3s;
        }

        .switch-device-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .content {
            padding: 20px;
            height: calc(100% - 88px);
            overflow-y: auto;
            color: #fff;
        }

        .device-header {
            background: #2a2a3e;
            border-radius: 20px;
            padding: 30px 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .device-avatar {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #FF8C42 0%, #FFA366 100%);
            border-radius: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .device-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 60px;
            object-fit: cover;
        }

        .device-name {
            font-size: 18px;
            font-weight: 500;
            color: #fff;
            margin-bottom: 10px;
        }

        .device-id {
            font-size: 14px;
            color: #999;
        }

        .device-info-section {
            background: #2a2a3e;
            border-radius: 16px;
            padding: 0;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .device-info-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a4e;
        }

        .device-info-item:last-child {
            border-bottom: none;
        }

        .device-info-label {
            font-size: 15px;
            color: #fff;
        }

        .device-info-value {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
            color: #ccc;
        }

        .battery-level {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .battery-icon {
            width: 24px;
            height: 12px;
            border: 1px solid #999;
            border-radius: 2px;
            position: relative;
            background: #2a2a3e;
        }

        .battery-icon::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 3px;
            width: 2px;
            height: 6px;
            background: #999;
            border-radius: 0 1px 1px 0;
        }

        .battery-fill {
            height: 100%;
            background: #0f0;
            border-radius: 1px;
            width: 80%;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            max-width: 200px;
        }

        .volume-slider {
            flex: 1;
            height: 4px;
            background: #3a3a4e;
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #FF8C42;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #FF8C42;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .device-action-section {
            background: #2a2a3e;
            border-radius: 16px;
            padding: 0;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .device-action-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a4e;
            cursor: pointer;
        }

        .device-action-item:last-child {
            border-bottom: none;
        }

        .device-action-label {
            font-size: 15px;
            color: #fff;
        }

        .device-action-value {
            font-size: 15px;
            color: #FF8C42;
        }

        .device-unbind {
            color: #ff4444;
        }

        .arrow-icon {
            font-size: 16px;
            color: #999;
        }

        /* ËÆæÂ§áÂàóË°®ÂºπÁ™ó */
        .device-list-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            align-items: flex-end;
        }

        .device-list-modal.show {
            display: flex;
        }

        .device-list-content {
            width: 100%;
            background: #2a2a3e;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .device-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .device-list-title {
            font-size: 18px;
            font-weight: 500;
            color: #fff;
        }

        .device-list-close {
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 20px;
            text-align: center;
            line-height: 24px;
            color: #fff;
        }

        .device-list-item {
            background: #3a3a4e;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .device-list-item:hover {
            background: #4a4a5e;
        }

        .device-list-item.active {
            background: #FF8C42;
        }

        .device-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .device-item-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FF8C42 0%, #FFA366 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .device-item-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .device-item-name {
            font-size: 15px;
            color: #fff;
            font-weight: 500;
        }

        .device-item-id {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
        }

        .device-item-check {
            font-size: 18px;
            color: #fff;
        }

        /* ËæìÂÖ•ÂºπÁ™ó */
        .input-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .input-modal.show {
            display: flex;
        }

        .input-modal-content {
            width: 320px;
            background: #2a2a3e;
            border-radius: 20px;
            padding: 20px;
            position: relative;
        }

        .input-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .input-modal-title {
            font-size: 18px;
            font-weight: 500;
            color: #fff;
        }

        .input-modal-close {
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 20px;
            text-align: center;
            line-height: 24px;
            color: #fff;
        }

        .input-modal-body {
            margin-bottom: 20px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            background: #1a1a2e;
            border: 1px solid #3a3a4e;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            outline: none;
        }

        .input-field:focus {
            border-color: #FF8C42;
        }

        .input-modal-buttons {
            display: flex;
            gap: 10px;
        }

        .input-modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            border: none;
        }

        .input-modal-btn-cancel {
            background: #3a3a4e;
            color: #fff;
        }

        .input-modal-btn-save {
            background: #FF8C42;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="screen">
            <div class="status-bar">
                <span>13:35</span>
                <span>üîã 100%</span>
            </div>
            
            <div class="header">
                <div class="back-button" onclick="window.location.href='pairing-set.html'">‚Üê</div>
                <div class="header-title">ËÆæÂ§áÁÆ°ÁêÜ</div>
                <div class="header-right">
                    <div class="switch-device-btn" onclick="showDeviceList()">‚áÑ</div>
                </div>
            </div>

            <div class="content">
                <div class="device-header">
                    <div class="device-avatar" id="deviceAvatar">
                        <img id="deviceAvatarImg" src="" alt="ËÆæÂ§áÂ§¥ÂÉè" style="display: none;">
                        <span id="deviceAvatarPlaceholder">ü§ñ</span>
                    </div>
                    <div class="device-id" id="deviceId">ID: 9C284003504A</div>
                </div>

                <div class="device-info-section">
                    <div class="device-info-item" onclick="editDollNickname()" style="cursor: pointer;">
                        <div class="device-info-label">Áé©ÂÅ∂ÊòµÁß∞</div>
                        <div class="device-info-value">
                            <span id="dollNickname">ÂôúÂôú</span>
                            <span class="arrow-icon">></span>
                        </div>
                    </div>
                </div>

                <div class="device-info-section">
                    <div class="device-info-item">
                        <div class="device-info-label">ËÆæÂ§áÁîµÈáè</div>
                        <div class="device-info-value">
                            <div class="battery-level">
                                <div class="battery-icon">
                                    <div class="battery-fill" id="batteryFill"></div>
                                </div>
                                <span id="batteryText">80%</span>
                            </div>
                        </div>
                    </div>
                    <div class="device-info-item">
                        <div class="device-info-label">ËÆæÂ§áÈü≥Èáè</div>
                        <div class="device-info-value">
                            <div class="volume-control">
                                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" oninput="updateVolume(this.value)">
                                <span id="volumeText">50%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="device-action-section">
                    <div class="device-action-item" onclick="window.location.href='pairing-guide.html?from=device-manage'">
                        <div class="device-action-label">ËÆæÂ§áÈáçÊñ∞ÈÖçÁΩë</div>
                        <div class="device-action-value">
                            <span class="arrow-icon">></span>
                        </div>
                    </div>
                    <div class="device-action-item" onclick="unbindDevice()">
                        <div class="device-action-label device-unbind">ËÆæÂ§áËß£Áªë</div>
                        <div class="device-action-value device-unbind">
                            <span class="arrow-icon">></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ËÆæÂ§áÂàóË°®ÂºπÁ™ó -->
            <div class="device-list-modal" id="deviceListModal" onclick="closeDeviceList(event)">
                <div class="device-list-content" onclick="event.stopPropagation()">
                    <div class="device-list-header">
                        <div class="device-list-title">ÂàáÊç¢ËÆæÂ§á</div>
                        <div class="device-list-close" onclick="closeDeviceList()">√ó</div>
                    </div>
                    <div id="deviceListContainer">
                        <!-- ËÆæÂ§áÂàóË°®Â∞ÜÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- ËæìÂÖ•ÂºπÁ™ó -->
            <div class="input-modal" id="inputModal" onclick="closeInputModal(event)">
                <div class="input-modal-content" onclick="event.stopPropagation()">
                    <div class="input-modal-header">
                        <div class="input-modal-title" id="inputModalTitle">ÁºñËæë</div>
                        <div class="input-modal-close" onclick="closeInputModal()">√ó</div>
                    </div>
                    <div class="input-modal-body">
                        <input type="text" class="input-field" id="inputField" placeholder="ËØ∑ËæìÂÖ•" maxlength="20">
                    </div>
                    <div class="input-modal-buttons">
                        <button class="input-modal-btn input-modal-btn-cancel" onclick="closeInputModal()">ÂèñÊ∂à</button>
                        <button class="input-modal-btn input-modal-btn-save" onclick="saveInput()">‰øùÂ≠ò</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Êõ¥Êñ∞Èü≥Èáè
        function updateVolume(value) {
            document.getElementById('volumeText').textContent = value + '%';
            // ËøôÈáåÂ∫îËØ•ÂèëÈÄÅÊåá‰ª§Âà∞ËÆæÂ§á
            console.log('ËÆæÁΩÆÈü≥Èáè:', value + '%');
        }

        // ËÆæÂ§áËß£Áªë
        function unbindDevice() {
            if (confirm('Á°ÆÂÆöË¶ÅËß£ÁªëËÆæÂ§áÂêóÔºüËß£ÁªëÂêéÈúÄË¶ÅÈáçÊñ∞ÈÖçÁΩëÊâçËÉΩ‰ΩøÁî®„ÄÇ')) {
                const deviceList = getDeviceList();
                const currentDeviceId = getCurrentDeviceId();
                
                // ‰ªéËÆæÂ§áÂàóË°®‰∏≠Âà†Èô§ÂΩìÂâçËÆæÂ§á
                const filteredList = deviceList.filter(d => d.id !== currentDeviceId);
                
                if (filteredList.length > 0) {
                    // Â¶ÇÊûúËøòÊúâÂÖ∂‰ªñËÆæÂ§áÔºåÂàáÊç¢Âà∞Á¨¨‰∏Ä‰∏™ËÆæÂ§á
                    localStorage.setItem('deviceList', JSON.stringify(filteredList));
                    const newCurrentDevice = filteredList[0];
                    localStorage.setItem('currentDeviceId', newCurrentDevice.id);
                    localStorage.setItem('deviceId', newCurrentDevice.id);
                    
                    // Âà∑Êñ∞È°µÈù¢‰ª•ÊòæÁ§∫Êñ∞ËÆæÂ§á
                    window.location.reload();
                } else {
                    // Â¶ÇÊûúÊ≤°ÊúâËÆæÂ§á‰∫ÜÔºåÊ∏ÖÈô§ÊâÄÊúâËÆæÂ§áÊï∞ÊçÆ
                    localStorage.removeItem('deviceList');
                    localStorage.removeItem('currentDeviceId');
                    localStorage.removeItem('deviceId');
                    localStorage.removeItem('devicePaired');
                    alert('ËÆæÂ§áÂ∑≤Ëß£Áªë');
                    // ËøîÂõûÈ¶ñÈ°µ
                    window.location.href = 'pairing-set.html';
                }
            }
        }

        // ÂΩìÂâçÁºñËæëÁ±ªÂûã
        let currentEditType = '';

        // ÁºñËæëÁé©ÂÅ∂ÊòµÁß∞
        function editDollNickname() {
            currentEditType = 'dollNickname';
            
            // ‰ªéÂΩìÂâçËÆæÂ§á‰∏≠Ëé∑ÂèñÊòµÁß∞
            const deviceList = getDeviceList();
            const currentDeviceId = getCurrentDeviceId();
            const currentDevice = deviceList.find(d => d.id === currentDeviceId);
            const currentValue = currentDevice ? (currentDevice.dollNickname || currentDevice.name || 'ÂôúÂôú') : 'ÂôúÂôú';
            
            document.getElementById('inputModalTitle').textContent = 'Áé©ÂÅ∂ÊòµÁß∞';
            document.getElementById('inputField').value = currentValue;
            document.getElementById('inputField').placeholder = 'ËØ∑ËæìÂÖ•Áé©ÂÅ∂ÊòµÁß∞';
            document.getElementById('inputModal').classList.add('show');
            document.getElementById('inputField').focus();
        }

        // ÂÖ≥Èó≠ËæìÂÖ•ÂºπÁ™ó
        function closeInputModal(event) {
            if (event && event.target !== event.currentTarget) {
                return;
            }
            document.getElementById('inputModal').classList.remove('show');
            currentEditType = '';
        }

        // ‰øùÂ≠òËæìÂÖ•
        function saveInput() {
            const value = document.getElementById('inputField').value.trim();
            if (currentEditType === 'dollNickname') {
                const nickname = value || 'ÂôúÂôú';
                
                // Êõ¥Êñ∞ËÆæÂ§áÂàóË°®‰∏≠ÁöÑÂΩìÂâçËÆæÂ§áÊòµÁß∞
                const deviceList = getDeviceList();
                const currentDeviceId = getCurrentDeviceId();
                const currentDevice = deviceList.find(d => d.id === currentDeviceId);
                if (currentDevice) {
                    currentDevice.name = nickname;
                    currentDevice.dollNickname = nickname;
                    localStorage.setItem('deviceList', JSON.stringify(deviceList));
                }
                
                // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
                document.getElementById('dollNickname').textContent = nickname;
                
                // Â¶ÇÊûúËÆæÂ§áÂàóË°®ÂºπÁ™óÊòØÊâìÂºÄÁöÑÔºåÈáçÊñ∞Ê∏≤Êüì
                const modal = document.getElementById('deviceListModal');
                if (modal.classList.contains('show')) {
                    renderDeviceList();
                }
            }
            closeInputModal();
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÊÅ¢Â§çËÆæÂ§á‰ø°ÊÅØ
        window.addEventListener('DOMContentLoaded', function() {
            // ÊÅ¢Â§çËÆæÂ§áÂ§¥ÂÉè
            const savedAvatar = localStorage.getItem('avatar');
            if (savedAvatar) {
                const avatarImg = document.getElementById('deviceAvatarImg');
                const avatarPlaceholder = document.getElementById('deviceAvatarPlaceholder');
                avatarImg.src = savedAvatar;
                avatarImg.style.display = 'block';
                avatarPlaceholder.style.display = 'none';
            } else {
                // Ê†πÊçÆÈÖçÁΩëÁä∂ÊÄÅÊòæÁ§∫‰∏çÂêåÂ§¥ÂÉè
                const isPaired = localStorage.getItem('devicePaired') === 'true';
                if (isPaired) {
                    document.getElementById('deviceAvatarPlaceholder').textContent = 'ü§ñ';
                } else {
                    document.getElementById('deviceAvatarPlaceholder').textContent = 'üò¥';
                }
            }

            // ÊÅ¢Â§çËÆæÂ§áIDÂíåÁîµÈáèÂ∞ÜÂú®ËÆæÂ§á‰ø°ÊÅØÊÅ¢Â§çÊó∂‰∏ÄËµ∑Â§ÑÁêÜ

            // ÊÅ¢Â§çÂΩìÂâçËÆæÂ§á‰ø°ÊÅØ
            const deviceList = getDeviceList();
            
            if (deviceList.length === 0) {
                // Â¶ÇÊûúÊ≤°ÊúâËÆæÂ§áÔºåË∑≥ËΩ¨Âà∞È¶ñÈ°µ
                alert('ËØ∑ÂÖàÁªëÂÆöËÆæÂ§á');
                window.location.href = 'pairing-set.html';
                return;
            }
            
            const currentDeviceId = getCurrentDeviceId();
            const currentDevice = deviceList.find(d => d.id === currentDeviceId) || deviceList[0];
            
            if (currentDevice) {
                // Â¶ÇÊûúÂΩìÂâçËÆæÂ§áID‰∏çÂ≠òÂú®ÔºåËÆæÁΩÆ‰∏∫Á¨¨‰∏Ä‰∏™ËÆæÂ§á
                if (!currentDeviceId || !deviceList.find(d => d.id === currentDeviceId)) {
                    localStorage.setItem('currentDeviceId', currentDevice.id);
                    localStorage.setItem('deviceId', currentDevice.id);
                }
                
                // ÊÅ¢Â§çÈü≥Èáè
                const volume = currentDevice.volume || 50;
                document.getElementById('volumeSlider').value = volume;
                document.getElementById('volumeText').textContent = volume + '%';
                
                // ÊÅ¢Â§çÁîµÈáè
                const batteryLevel = currentDevice.batteryLevel || 80;
                updateBattery(batteryLevel);
                
                // ÊÅ¢Â§çÁé©ÂÅ∂ÊòµÁß∞Ôºà‰ªéÂΩìÂâçËÆæÂ§á‰∏≠Ëé∑ÂèñÔºâ
                const dollNickname = currentDevice.dollNickname || currentDevice.name || 'ÂôúÂôú';
                document.getElementById('dollNickname').textContent = dollNickname;
                
                // ÊÅ¢Â§çËÆæÂ§áIDÊòæÁ§∫
                document.getElementById('deviceId').textContent = 'ID: ' + currentDevice.id;
            }
        });

        // Êõ¥Êñ∞ÁîµÈáèÊòæÁ§∫
        function updateBattery(level) {
            document.getElementById('batteryFill').style.width = level + '%';
            document.getElementById('batteryText').textContent = level + '%';
            
            // Ê†πÊçÆÁîµÈáèÊîπÂèòÈ¢úËâ≤
            const batteryFill = document.getElementById('batteryFill');
            if (level > 50) {
                batteryFill.style.background = '#0f0';
            } else if (level > 20) {
                batteryFill.style.background = '#ffd700';
            } else {
                batteryFill.style.background = '#ff4444';
            }
        }

        // ‰øùÂ≠òÈü≥ÈáèËÆæÁΩÆ
        document.getElementById('volumeSlider').addEventListener('change', function() {
            const volume = parseInt(this.value);
            localStorage.setItem('deviceVolume', volume);
            
            // ÂêåÊó∂‰øùÂ≠òÂà∞ÂΩìÂâçËÆæÂ§áÂØπË±°‰∏≠
            const deviceList = getDeviceList();
            const currentDeviceId = getCurrentDeviceId();
            const currentDevice = deviceList.find(d => d.id === currentDeviceId);
            if (currentDevice) {
                currentDevice.volume = volume;
                localStorage.setItem('deviceList', JSON.stringify(deviceList));
            }
        });

        // Ëé∑ÂèñËÆæÂ§áÂàóË°®
        function getDeviceList() {
            const deviceListStr = localStorage.getItem('deviceList');
            if (deviceListStr) {
                return JSON.parse(deviceListStr);
            }
            // Â¶ÇÊûúÊ≤°ÊúâËÆæÂ§áÂàóË°®ÔºåËøîÂõûÁ©∫Êï∞ÁªÑÔºàËÆæÂ§áÈúÄË¶ÅÈÄöËøáÈÖçÁΩëÊµÅÁ®ãÊ∑ªÂä†Ôºâ
            return [];
        }

        // Ëé∑ÂèñÂΩìÂâçËÆæÂ§áID
        function getCurrentDeviceId() {
            const currentId = localStorage.getItem('currentDeviceId');
            if (currentId) {
                return currentId;
            }
            // Â¶ÇÊûúÊ≤°ÊúâÂΩìÂâçËÆæÂ§áIDÔºåÂ∞ùËØï‰ªéËÆæÂ§áÂàóË°®‰∏≠Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™ËÆæÂ§á
            const deviceList = getDeviceList();
            if (deviceList.length > 0) {
                const firstDeviceId = deviceList[0].id;
                localStorage.setItem('currentDeviceId', firstDeviceId);
                return firstDeviceId;
            }
            return null;
        }

        // ÊòæÁ§∫ËÆæÂ§áÂàóË°®
        function showDeviceList() {
            const modal = document.getElementById('deviceListModal');
            modal.classList.add('show');
            renderDeviceList();
        }

        // ÂÖ≥Èó≠ËÆæÂ§áÂàóË°®
        function closeDeviceList(event) {
            if (event && event.target !== event.currentTarget) {
                return;
            }
            const modal = document.getElementById('deviceListModal');
            modal.classList.remove('show');
        }

        // Ê∏≤ÊüìËÆæÂ§áÂàóË°®
        function renderDeviceList() {
            const deviceList = getDeviceList();
            const currentDeviceId = getCurrentDeviceId();
            const container = document.getElementById('deviceListContainer');
            
            container.innerHTML = '';
            
            deviceList.forEach(device => {
                const isActive = device.id === currentDeviceId;
                const deviceItem = document.createElement('div');
                deviceItem.className = 'device-list-item' + (isActive ? ' active' : '');
                deviceItem.onclick = () => switchDevice(device.id);
                
                // ‰ΩøÁî®ËÆæÂ§áËá™Â∑±ÁöÑÁé©ÂÅ∂ÊòµÁß∞
                const displayName = device.dollNickname || device.name || 'ÂôúÂôú';
                
                deviceItem.innerHTML = `
                    <div class="device-item-info">
                        <div class="device-item-avatar">${device.avatar || 'ü§ñ'}</div>
                        <div class="device-item-details">
                            <div class="device-item-name">${displayName}</div>
                            <div class="device-item-id">ID: ${device.id}</div>
                        </div>
                    </div>
                    ${isActive ? '<div class="device-item-check">‚úì</div>' : ''}
                `;
                
                container.appendChild(deviceItem);
            });
        }

        // ÂàáÊç¢ËÆæÂ§á
        function switchDevice(deviceId) {
            const deviceList = getDeviceList();
            const device = deviceList.find(d => d.id === deviceId);
            
            if (device) {
                localStorage.setItem('currentDeviceId', deviceId);
                localStorage.setItem('deviceId', deviceId);
                
                // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
                document.getElementById('deviceId').textContent = 'ID: ' + deviceId;
                
                // ÊÅ¢Â§çÈü≥Èáè
                const volume = device.volume || 50;
                document.getElementById('volumeSlider').value = volume;
                document.getElementById('volumeText').textContent = volume + '%';
                
                // ÊÅ¢Â§çÁîµÈáè
                updateBattery(device.batteryLevel || 80);
                
                // ÊÅ¢Â§çÁé©ÂÅ∂ÊòµÁß∞
                const dollNickname = device.dollNickname || device.name || 'ÂôúÂôú';
                document.getElementById('dollNickname').textContent = dollNickname;
                
                // Êõ¥Êñ∞ËÆæÂ§áÂ§¥ÂÉè
                if (device.avatar) {
                    const avatarImg = document.getElementById('deviceAvatarImg');
                    const avatarPlaceholder = document.getElementById('deviceAvatarPlaceholder');
                    avatarImg.src = device.avatar;
                    avatarImg.style.display = 'block';
                    avatarPlaceholder.style.display = 'none';
                } else {
                    const avatarImg = document.getElementById('deviceAvatarImg');
                    const avatarPlaceholder = document.getElementById('deviceAvatarPlaceholder');
                    avatarImg.style.display = 'none';
                    avatarPlaceholder.style.display = 'flex';
                    avatarPlaceholder.textContent = 'ü§ñ';
                }
                
                closeDeviceList();
            }
        }

    </script>
</body>
</html>