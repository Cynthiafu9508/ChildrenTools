# 配网流程完整流程图

```mermaid
flowchart TD
    Start([用户进入配网流程]) --> GuidePage[配网引导页面]
    
    GuidePage --> CheckDevice{设备是否已开机?}
    CheckDevice -->|未开机| ShowGuide[显示开机指引<br/>① 设备开机<br/>② 自动进入配网模式]
    CheckDevice -->|已开机| ShowButton[显示开始配网按钮]
    
    ShowGuide --> WaitUser[等待用户操作]
    WaitUser --> UserClick{用户点击开始配网?}
    UserClick -->|否| WaitUser
    UserClick -->|是| ButtonFeedback[按钮反馈<br/>显示加载状态]
    
    ShowButton --> UserClick
    ButtonFeedback --> DeviceScanPage[进入设备扫描页面]
    
    DeviceScanPage --> ShowScanning[显示扫描状态<br/>正在扫描设备...]
    ShowScanning --> StartScan[开始扫描设备]
    
    StartScan --> ScanResult{扫描结果}
    
    ScanResult -->|找到设备| ShowDeviceList[显示设备列表]
    ScanResult -->|未找到设备| ShowEmpty[显示空状态<br/>未找到设备]
    ScanResult -->|扫描超时| ShowTimeout[显示超时提示]
    ScanResult -->|扫描错误| ShowError[显示错误提示]
    
    ShowEmpty --> EmptyAction{用户操作}
    EmptyAction -->|点击重新扫描| StartScan
    EmptyAction -->|点击返回| GuidePage
    EmptyAction -->|查看帮助| ShowHelp[显示帮助信息<br/>找不到设备的原因]
    
    ShowTimeout --> TimeoutAction{用户操作}
    TimeoutAction -->|点击重试| StartScan
    TimeoutAction -->|点击返回| GuidePage
    
    ShowError --> ErrorAction{用户操作}
    ErrorAction -->|点击重试| StartScan
    ErrorAction -->|查看帮助| ShowHelp
    
    ShowDeviceList --> UserSelect{用户选择设备}
    UserSelect -->|点击设备卡片| DeviceClick[设备卡片点击反馈]
    UserSelect -->|未选择| WaitSelect[等待用户选择]
    WaitSelect --> UserSelect
    
    DeviceClick --> BindDevice[绑定设备]
    BindDevice --> BindResult{绑定结果}
    
    BindResult -->|成功| ShowBindSuccess[显示绑定成功<br/>设备绑定成功]
    BindResult -->|失败| ShowBindError[显示绑定失败<br/>请重试]
    
    ShowBindError --> BindRetry{用户操作}
    BindRetry -->|点击重试| BindDevice
    BindRetry -->|点击返回| DeviceScanPage
    
    ShowBindSuccess --> ShowNextButton[显示开始配网按钮]
    ShowNextButton --> NextClick{用户点击开始配网?}
    NextClick -->|否| WaitNext[等待用户操作]
    WaitNext --> NextClick
    NextClick -->|是| WifiModal[打开WiFi配置弹窗]
    
    WifiModal --> ClearInput[清除之前的输入和错误状态]
    ClearInput --> WifiInput[WiFi输入界面]
    
    WifiInput --> WifiAction{用户操作}
    
    WifiAction -->|点击选择WiFi| OpenWifiList[打开WiFi列表弹窗]
    WifiAction -->|手动输入WiFi名称| ManualInput[手动输入WiFi名称]
    WifiAction -->|输入WiFi密码| PasswordInput[输入WiFi密码]
    WifiAction -->|点击开始配网| ValidateInput[校验输入]
    
    OpenWifiList --> ShowScanningWifi[显示扫描WiFi状态<br/>正在搜索WiFi网络...]
    ShowScanningWifi --> ScanWifi[开始搜索WiFi]
    
    ScanWifi --> WifiScanResult{WiFi扫描结果}
    
    WifiScanResult -->|找到WiFi| ShowWifiList[显示WiFi列表]
    WifiScanResult -->|未找到WiFi| ShowWifiEmpty[显示WiFi空状态<br/>未搜索到WiFi网络]
    WifiScanResult -->|扫描超时| ShowWifiTimeout[显示WiFi扫描超时]
    WifiScanResult -->|扫描错误| ShowWifiError[显示WiFi扫描错误]
    
    ShowWifiEmpty --> WifiEmptyAction{用户操作}
    WifiEmptyAction -->|点击重新搜索| ScanWifi
    WifiEmptyAction -->|点击关闭| WifiInput
    WifiEmptyAction -->|查看原因| ShowWifiReason[显示可能的原因<br/>1. 手机WiFi未开启<br/>2. 当前位置无WiFi<br/>3. WiFi信号太弱<br/>4. 隐藏WiFi不显示]
    
    ShowWifiTimeout --> WifiTimeoutAction{用户操作}
    WifiTimeoutAction -->|点击重试| ScanWifi
    WifiTimeoutAction -->|点击关闭| WifiInput
    
    ShowWifiError --> WifiErrorAction{用户操作}
    WifiErrorAction -->|点击重试| ScanWifi
    WifiErrorAction -->|点击关闭| WifiInput
    
    ShowWifiList --> SelectWifi{用户选择WiFi}
    SelectWifi -->|点击WiFi项| FillWifiName[填充WiFi名称到输入框]
    SelectWifi -->|点击关闭| WifiInput
    
    FillWifiName --> ValidateWifiName[校验WiFi名称]
    ValidateWifiName --> CloseWifiList[关闭WiFi列表]
    CloseWifiList --> WifiInput
    
    ManualInput --> RealTimeValidate[实时校验WiFi名称]
    RealTimeValidate --> ValidateResult{校验结果}
    
    ValidateResult -->|通过| ClearError[清除错误状态]
    ValidateResult -->|失败| ShowNameError[显示WiFi名称错误<br/>1. 名称不能为空<br/>2. 长度1-32字符<br/>3. 字符限制提示<br/>4. 不能全为空格]
    
    ShowNameError --> NameErrorAction{用户操作}
    NameErrorAction -->|继续输入| ManualInput
    NameErrorAction -->|选择WiFi| OpenWifiList
    
    ClearError --> WifiInput
    
    PasswordInput --> PasswordValidate[校验密码]
    PasswordValidate --> PasswordResult{校验结果}
    PasswordResult -->|通过| WifiInput
    PasswordResult -->|失败| ShowPasswordError[显示密码错误<br/>密码至少8个字符]
    ShowPasswordError --> PasswordInput
    
    ValidateInput --> CheckWifiName{WiFi名称校验}
    CheckWifiName -->|未填写| ShowWifiNameError[显示错误:请选择或输入WiFi网络]
    CheckWifiName -->|格式错误| ShowWifiNameError
    CheckWifiName -->|通过| CheckPassword{WiFi密码校验}
    
    ShowWifiNameError --> ScrollToError[滚动到错误位置]
    ScrollToError --> WifiInput
    
    CheckPassword -->|未填写| ShowPasswordRequired[显示错误:请输入WiFi密码]
    CheckPassword -->|长度不足| ShowPasswordLength[显示错误:密码至少8个字符]
    CheckPassword -->|长度超限| ShowPasswordLength2[显示错误:密码不能超过64个字符]
    CheckPassword -->|通过| CloseWifiModal[关闭WiFi弹窗]
    
    ShowPasswordRequired --> WifiInput
    ShowPasswordLength --> WifiInput
    ShowPasswordLength2 --> WifiInput
    
    CloseWifiModal --> ShowSending[显示发送状态<br/>正在发送WiFi凭证...]
    ShowSending --> SendWifi[发送WiFi凭证到设备]
    
    SendWifi --> SendResult{发送结果}
    
    SendResult -->|成功| ShowPairingSuccess[显示配网成功<br/>设备配网成功!]
    SendResult -->|失败| ShowPairingError[显示配网失败<br/>配网失败，请重试]
    SendResult -->|超时| ShowPairingTimeout[显示配网超时]
    
    ShowPairingError --> PairingErrorAction{用户操作}
    PairingErrorAction -->|点击重试| WifiModal
    PairingErrorAction -->|点击关闭| DeviceScanPage
    
    ShowPairingTimeout --> PairingTimeoutAction{用户操作}
    PairingTimeoutAction -->|点击重试| WifiModal
    PairingTimeoutAction -->|点击关闭| DeviceScanPage
    
    ShowPairingSuccess --> SuccessClick{用户点击完成}
    SuccessClick --> SaveDevice[保存设备信息到本地]
    SaveDevice --> SetPaired[设置配网完成状态]
    SetPaired --> CheckFrom{来源判断}
    
    CheckFrom -->|来自设备管理| GoDeviceManage[跳转到设备管理页面]
    CheckFrom -->|来自首页| GoHomePage[跳转到首页<br/>显示配对成功状态]
    
    GoDeviceManage --> End1([配网流程结束])
    GoHomePage --> End2([配网流程结束])
    
    ShowHelp --> HelpAction{用户操作}
    HelpAction -->|返回| DeviceScanPage
    HelpAction -->|继续扫描| StartScan
    
    ShowWifiReason --> WifiReasonAction{用户操作}
    WifiReasonAction -->|手动输入| WifiInput
    WifiReasonAction -->|重新搜索| ScanWifi
    WifiReasonAction -->|关闭| WifiInput
    
    style Start fill:#e1f5ff
    style End1 fill:#e1f5ff
    style End2 fill:#e1f5ff
    style ShowBindSuccess fill:#d4edda
    style ShowPairingSuccess fill:#d4edda
    style ShowBindError fill:#f8d7da
    style ShowPairingError fill:#f8d7da
    style ShowError fill:#f8d7da
    style ShowWifiError fill:#f8d7da
    style ShowNameError fill:#f8d7da
    style ShowPasswordError fill:#f8d7da
    style ShowEmpty fill:#fff3cd
    style ShowWifiEmpty fill:#fff3cd
    style ShowScanning fill:#cfe2ff
    style ShowSending fill:#cfe2ff
    style ShowScanningWifi fill:#cfe2ff
```

## 流程图说明

### 主要流程节点

1. **配网引导页面**
   - 显示设备开机指引
   - 提供开始配网按钮
   - 添加操作提示和帮助信息

2. **设备扫描阶段**
   - 扫描状态提示
   - 空状态处理（未找到设备）
   - 超时处理
   - 错误处理
   - 重新扫描功能

3. **设备绑定阶段**
   - 设备选择反馈
   - 绑定成功/失败处理
   - 重试机制

4. **WiFi配置阶段**
   - WiFi列表搜索（支持扫描状态、空状态、错误处理）
   - 手动输入WiFi名称（实时校验）
   - 密码输入校验
   - 输入完整性校验

5. **配网发送阶段**
   - 发送状态提示
   - 成功/失败/超时处理
   - 重试机制

### 异常情况处理

1. **信息缺失**
   - 添加步骤指示器
   - 添加操作提示
   - 添加帮助信息
   - 添加错误说明

2. **操作迷茫**
   - 明确的操作指引
   - 状态文字说明
   - 帮助信息提示
   - 下一步操作提示

3. **状态未知**
   - 扫描状态提示
   - 加载状态提示
   - 进度反馈
   - 状态文字说明

4. **行为无反馈**
   - 按钮点击反馈
   - 操作成功/失败提示
   - 错误信息提示
   - 动画效果反馈

### 关键校验点

1. **WiFi名称校验**
   - 不能为空
   - 长度1-32字符
   - 字符限制（中文、英文、数字、连字符、下划线、点号）
   - 不能全为空格
   - 实时校验和失焦校验

2. **WiFi密码校验**
   - 不能为空
   - 长度8-64字符
   - 提交时校验

3. **设备扫描校验**
   - 扫描超时处理
   - 扫描错误处理
   - 空结果处理

4. **配网发送校验**
   - 发送超时处理
   - 发送错误处理
   - 重试机制
