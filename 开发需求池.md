# 开发需求池

> 本文档用于追踪AI玩具小程序各功能模块的开发进度
> 
> 更新时间：2025-01-XX
> 
> 状态说明：
> - ✅ 已完成
> - 🚧 开发中
> - ⏳ 待开发
> - ❌ 已取消

---

## 一、核心功能模块

### 1. 伙伴模块 (pairing-set.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 玩偶状态显示 | 根据设备绑定状态显示睡眠/清醒动画 | ✅ | 已实现设备检测和状态切换 |
| 设备绑定检查 | 检查是否有已绑定设备，无设备时显示提示 | ✅ | 基于localStorage实现 |
| 聊天记录查看 | 日记功能，查看历史聊天记录 | ✅ | 支持按日期分组显示 |
| 添加设备入口 | 跳转到配网引导页面 | ✅ | 导航到pairing-guide.html |
| 设备管理入口 | 跳转到设备管理页面 | ✅ | 导航到device-manage.html |
| 底部导航栏 | 四个主要模块的导航 | ✅ | 伙伴/剧场/成长/我的 |

**待优化项：**
- ⏳ 聊天记录数据持久化（当前使用示例数据）
- ⏳ 玩偶动画效果优化
- ⏳ 实时设备状态同步

---

### 2. 剧场模块 (theater-demo.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 剧集列表展示 | 显示7集剧集，支持锁定/解锁/已完成状态 | ✅ | 已实现完整UI和状态管理 |
| 解锁规则系统 | 第1集直接播放，第2集需3轮沟通，第3集需5轮沟通，第4-7集需5轮沟通+24小时 | ✅ | 完整实现解锁逻辑 |
| 进度条显示 | 显示沟通轮次进度和24小时倒计时 | ✅ | 动态显示当前解锁集数进度 |
| 状态持久化 | 使用localStorage保存播放进度和解锁状态 | ✅ | 支持页面刷新后恢复 |
| 演示功能 | C键增加沟通轮次，D键增加24小时，重置按钮 | ✅ | 仅用于演示 |
| 解锁信息弹窗 | 点击锁定集数时显示解锁条件 | ✅ | 不显示已完成任务 |
| 底部导航栏 | 四个主要模块的导航 | ✅ | 伙伴/剧场/成长/我的 |

**待优化项：**
- ⏳ 真实视频资源接入
- ⏳ 沟通轮次与后端API对接
- ⏳ 24小时计时器优化（考虑时区问题）

---

### 3. 视频播放模块 (video-player.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 视频播放控制 | 播放/暂停、进度条拖拽、时间显示 | ✅ | 基于HTML5 video实现 |
| 播放进度保存 | 保存每集的播放进度，支持断点续播 | ✅ | 使用localStorage存储 |
| 任务完成标记 | 播放完成后标记集数为已完成 | ✅ | 同步更新theater-demo状态 |
| 上一集/下一集 | 支持集数间切换 | ✅ | 下一集会检查解锁状态 |
| 状态同步 | 与theater-demo.html状态同步 | ✅ | 使用统一的demoState |
| 返回导航 | 返回剧场页面 | ✅ | 返回到theater-demo.html |

**待优化项：**
- ⏳ 真实视频资源替换占位内容
- ⏳ 任务完成验证逻辑（当前为模拟）
- ⏳ 播放器UI优化（全屏、倍速等）

---

### 4. 成长模块 (growth.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 功能模块展示 | 展示5个功能模块（英语启蒙、百科知识、数感培养、睡前故事、诗词教学） | ✅ | UI已完成 |
| 主题选择 | 点击模块选择主题 | ✅ | 当前为alert提示，需对接后端 |
| 设备绑定检查 | 无设备时显示提示 | ✅ | 显示睡眠状态 |
| 底部导航栏 | 四个主要模块的导航 | ✅ | 伙伴/剧场/成长/我的 |

**待优化项：**
- ⏳ 主题选择与玩偶指令发送对接
- ⏳ 功能模块内容详情页
- ⏳ 学习记录和统计功能

---

### 5. 我的模块 (mine.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 用户信息展示 | 显示头像、昵称、UID、性别、生日 | ✅ | 支持从localStorage恢复 |
| 头像编辑 | 支持拍照或从相册选择 | ✅ | 使用FileReader实现 |
| 昵称编辑 | 支持修改昵称 | ✅ | 弹窗编辑，保存到localStorage |
| 性别选择 | 支持选择性别（男/女/其他） | ✅ | 弹窗选择 |
| 生日选择 | 支持选择生日 | ✅ | 使用date input |
| 帮助与客服 | 跳转到帮助页面 | ✅ | 导航到help.html |
| 版本号显示 | 显示当前版本号 | ✅ | 固定显示1.0.28 |
| 退出登录 | 清除所有本地数据 | ✅ | 清除localStorage |
| 底部导航栏 | 四个主要模块的导航 | ✅ | 伙伴/剧场/成长/我的 |

**待优化项：**
- ⏳ 用户信息与后端同步
- ⏳ 头像上传功能
- ⏳ 更多设置选项

---

## 二、设备管理模块

### 6. 设备管理 (device-manage.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 设备信息展示 | 显示设备头像、ID、玩偶昵称 | ✅ | 从localStorage读取 |
| 玩偶昵称编辑 | 支持修改当前设备的玩偶昵称 | ✅ | 弹窗编辑，保存到设备列表 |
| 电量显示 | 显示设备电量百分比和可视化电池图标 | ✅ | 支持颜色变化（绿/黄/红） |
| 音量控制 | 滑块控制设备音量（0-100%） | ✅ | 保存到设备对象 |
| 设备切换 | 支持在多设备间切换 | ✅ | 设备列表弹窗，支持多设备管理 |
| 设备重新配网 | 跳转到配网引导页面 | ✅ | 导航到pairing-guide.html |
| 设备解绑 | 解绑当前设备 | ✅ | 支持多设备场景，解绑后切换或返回首页 |

**待优化项：**
- ⏳ 电量实时更新（需对接设备API）
- ⏳ 音量控制与设备同步
- ⏳ 设备在线状态检测

---

### 7. 设备选择 (pairing-select.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 设备搜索 | 蓝牙搜索附近设备 | ⏳ | 当前为静态展示，需对接蓝牙API |
| 设备选择 | 选择要绑定的设备 | ✅ | UI已完成，点击后进入配网流程 |
| WiFi配置 | 选择WiFi网络并输入密码 | ✅ | 支持WiFi列表选择，仅支持2.4G |
| 配网状态显示 | 显示配网进度和结果 | ✅ | 加载/成功状态切换 |
| 用户信息填写 | 首次配网时填写用户信息 | ✅ | 昵称、性别、生日，可跳过 |
| 设备绑定 | 完成配网后绑定设备 | ✅ | 保存到设备列表，设置当前设备 |

**待优化项：**
- ⏳ 蓝牙设备搜索功能实现
- ⏳ WiFi配置与设备通信
- ⏳ 配网失败重试机制
- ⏳ 错误处理和提示优化

---

### 8. 配网引导 (pairing-guide.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 配网步骤说明 | 显示设备开机和进入配网模式的步骤 | ✅ | 图文说明 |
| 开始配网按钮 | 跳转到设备选择页面 | ✅ | 导航到pairing-select.html |
| 返回导航 | 根据来源返回对应页面 | ✅ | 支持从设备管理页面进入 |

**待优化项：**
- ⏳ 配网步骤图片资源
- ⏳ 动画演示效果

---

## 三、辅助功能模块

### 9. 帮助与客服 (help.html)

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 配网失败提示 | 显示配网失败的处理方法 | ✅ | 文字说明 |
| 常见问题解答 | 蓝牙和WiFi相关问题解答 | ✅ | 分类展示 |
| 联系方式 | 显示客服邮箱 | ✅ | service@doki-doki.top |
| 返回导航 | 返回我的页面 | ✅ | 导航到mine.html |

**待优化项：**
- ⏳ 在线客服功能
- ⏳ 问题反馈功能
- ⏳ FAQ搜索功能

---

## 四、通用功能

### 10. 导航系统

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| 底部导航栏 | 四个主要模块的导航 | ✅ | 伙伴/剧场/成长/我的 |
| 页面间跳转 | 各页面间的导航链接 | ✅ | 已统一使用theater-demo.html |
| 返回按钮 | 各子页面的返回功能 | ✅ | 支持来源参数，返回对应页面 |

**待优化项：**
- ⏳ 导航栏图标优化
- ⏳ 页面切换动画

---

### 11. 数据存储

| 功能点 | 描述 | 状态 | 备注 |
|--------|------|------|------|
| localStorage存储 | 用户信息、设备列表、播放进度等 | ✅ | 已实现基础存储 |
| 状态同步 | 各页面间的状态同步 | ✅ | 使用统一的key命名 |
| 数据持久化 | 页面刷新后恢复数据 | ✅ | 页面加载时恢复 |

**待优化项：**
- ⏳ 数据加密存储
- ⏳ 数据备份和恢复
- ⏳ 与后端API数据同步

---

## 五、待开发功能

### 12. 后端API对接

| 功能点 | 描述 | 状态 | 优先级 |
|--------|------|------|--------|
| 用户认证 | 登录、注册、token管理 | ⏳ | 高 |
| 设备管理API | 设备绑定、解绑、状态查询 | ⏳ | 高 |
| 剧场数据API | 剧集列表、解锁状态、播放进度 | ⏳ | 高 |
| 沟通轮次API | 记录和查询沟通轮次 | ⏳ | 高 |
| 成长模块API | 主题选择、学习记录 | ⏳ | 中 |
| 聊天记录API | 聊天记录的存储和查询 | ⏳ | 中 |
| 用户信息API | 用户信息的同步 | ⏳ | 中 |

---

### 13. 蓝牙功能

| 功能点 | 描述 | 状态 | 优先级 |
|--------|------|------|--------|
| 蓝牙设备搜索 | 搜索附近的蓝牙设备 | ⏳ | 高 |
| 蓝牙连接 | 与设备建立蓝牙连接 | ⏳ | 高 |
| 指令发送 | 向设备发送控制指令 | ⏳ | 高 |
| 状态接收 | 接收设备状态信息 | ⏳ | 高 |
| 断线重连 | 蓝牙断线后自动重连 | ⏳ | 中 |

---

### 14. 实时通信

| 功能点 | 描述 | 状态 | 优先级 |
|--------|------|------|--------|
| WebSocket连接 | 与后端建立WebSocket连接 | ⏳ | 中 |
| 实时消息推送 | 接收服务器推送的消息 | ⏳ | 中 |
| 设备状态同步 | 实时同步设备状态 | ⏳ | 中 |

---

### 15. 性能优化

| 功能点 | 描述 | 状态 | 优先级 |
|--------|------|------|--------|
| 图片懒加载 | 优化图片加载性能 | ⏳ | 中 |
| 代码压缩 | 生产环境代码压缩 | ⏳ | 中 |
| 缓存策略 | 优化资源缓存 | ⏳ | 低 |
| 首屏加载优化 | 优化首屏加载速度 | ⏳ | 中 |

---

### 16. 错误处理

| 功能点 | 描述 | 状态 | 优先级 |
|--------|------|------|--------|
| 网络错误处理 | 网络请求失败的处理 | ⏳ | 高 |
| 异常捕获 | 全局异常捕获和上报 | ⏳ | 高 |
| 错误提示优化 | 用户友好的错误提示 | ⏳ | 中 |
| 日志上报 | 错误日志上报到服务器 | ⏳ | 中 |

---

## 六、测试需求

### 17. 功能测试

| 测试项 | 描述 | 状态 | 优先级 |
|--------|------|------|--------|
| 设备绑定流程测试 | 完整测试设备绑定流程 | ⏳ | 高 |
| 剧场解锁规则测试 | 测试各集解锁规则 | ✅ | 高 |
| 状态同步测试 | 测试页面间状态同步 | ✅ | 高 |
| 数据持久化测试 | 测试数据保存和恢复 | ✅ | 中 |
| 多设备场景测试 | 测试多设备切换和管理 | ✅ | 中 |

---

### 18. 兼容性测试

| 测试项 | 描述 | 状态 | 优先级 |
|--------|------|------|--------|
| iOS兼容性 | 测试iOS系统兼容性 | ⏳ | 高 |
| Android兼容性 | 测试Android系统兼容性 | ⏳ | 高 |
| 微信小程序兼容性 | 测试微信小程序环境 | ⏳ | 高 |
| 不同屏幕尺寸 | 测试不同屏幕尺寸适配 | ✅ | 中 |

---

## 七、已知问题

### 19. Bug列表

| Bug描述 | 影响范围 | 状态 | 优先级 |
|---------|----------|------|--------|
| 无 | 当前无已知严重bug | - | - |

---

## 八、开发计划

### 近期计划（1-2周）

1. **后端API对接**
   - 用户认证接口
   - 设备管理接口
   - 剧场数据接口

2. **蓝牙功能实现**
   - 蓝牙设备搜索
   - 蓝牙连接和通信

3. **错误处理优化**
   - 网络错误处理
   - 异常捕获和上报

### 中期计划（1个月）

1. **功能完善**
   - 成长模块内容对接
   - 聊天记录功能完善
   - 实时通信功能

2. **性能优化**
   - 首屏加载优化
   - 资源缓存策略

3. **测试完善**
   - 功能测试
   - 兼容性测试

### 长期计划（2-3个月）

1. **新功能开发**
   - 学习统计功能
   - 成就系统
   - 社交功能

2. **用户体验优化**
   - UI/UX优化
   - 动画效果
   - 交互优化

---

## 九、技术栈

- **前端框架**: 原生HTML/CSS/JavaScript
- **存储方案**: localStorage
- **UI设计**: 移动端适配，375px宽度设计
- **兼容性**: 微信小程序环境

---

## 十、备注

- 当前所有功能均基于前端实现，数据存储在localStorage
- 演示功能（C键、D键、重置按钮）仅用于开发测试，生产环境需移除
- 部分功能（如蓝牙、视频播放）需要真实硬件和资源支持
- 建议优先完成后端API对接，再逐步替换前端模拟数据

---

**文档维护说明：**
- 本文档应随开发进度实时更新
- 状态变更时需更新对应功能点的状态和备注
- 新增功能或发现bug时需及时补充到文档中
