<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è§†é¢‘æ’­æ”¾ - AIç©å…·å°ç¨‹åº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .phone-container {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 8px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .screen {
            width: 100%;
            height: 100%;
            background: #000;
            border-radius: 32px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .video-header {
            height: 44px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            position: relative;
            z-index: 100;
        }

        .video-back {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
            transition: background 0.3s;
            font-size: 14px;
            flex-shrink: 0;
        }

        .video-back:hover {
            background: rgba(255,255,255,0.3);
        }

        .video-back:active {
            background: rgba(255,255,255,0.4);
        }

        .video-title {
            font-size: 16px;
            font-weight: 500;
            flex: 1;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-left: 15px;
            min-width: 0;
        }

        .video-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: #000;
            overflow: hidden;
        }

        .video-player {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .video-controls {
            padding: 20px;
            background: rgba(0,0,0,0.8);
            color: #fff;
            position: relative;
            z-index: 100;
        }

        .task-info {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .task-info-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .task-info-desc {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            line-height: 1.5;
        }

        .video-progress-container {
            margin-bottom: 15px;
        }

        .video-progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .video-progress-fill {
            height: 100%;
            background: #FF8C42;
            border-radius: 2px;
            transition: width 0.1s linear;
        }

        .video-progress-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: #FF8C42;
            border-radius: 50%;
            cursor: pointer;
        }

        .video-time {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 15px;
        }

        .video-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }

        .video-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .video-btn:active {
            background: rgba(255,255,255,0.3);
        }

        .video-btn.play {
            width: 60px;
            height: 60px;
            background: #FF8C42;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="screen">
            <div class="video-header">
            <div class="video-back" id="videoBack">
                <span>â†</span>
                <span>è¿”å›å‰§åœº</span>
            </div>
            <div class="video-title" id="videoTitle">ç¬¬1é›†ï¼šä¸æ˜Ÿå®ç›¸è¯†</div>
        </div>
        <div class="video-container">
            <video class="video-player" id="videoPlayer" controls>
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
            </video>
        </div>
        <div class="video-controls">
            <div class="task-info">
                <div class="task-info-title">ğŸ“‹ ä»»åŠ¡è¯´æ˜</div>
                <div class="task-info-desc" id="taskDesc">ä»»åŠ¡è¯´æ˜ï¼šç”¨è‹±æ–‡åšè‡ªæˆ‘ä»‹ç»ï¼ŒåŒ…å«"my,name,like"ç­‰é«˜é¢‘ä¸»é¢˜è¯ã€‚</div>
            </div>
            <div class="video-progress-container">
                <div class="video-progress-bar" id="videoProgressBar">
                    <div class="video-progress-fill" id="videoProgressFill"></div>
                    <div class="video-progress-handle" id="videoProgressHandle"></div>
                </div>
                <div class="video-time">
                    <span id="currentTime">00:00</span>
                    <span id="totalTime">00:00</span>
                </div>
            </div>
            <div class="video-buttons">
                <button class="video-btn" id="prevBtn">â®</button>
                <button class="video-btn play" id="playPauseBtn">â–¶</button>
                <button class="video-btn" id="nextBtn">â­</button>
            </div>
        </div>
        </div>
    </div>

    <script>
        // åŠ¨ç”»ç‰‡æ•°æ®
        const episodes = [
            { id: 1, title: 'ä¸æ˜Ÿå®ç›¸è¯†', task: 'ä»»åŠ¡è¯´æ˜ï¼šç”¨è‹±æ–‡åšè‡ªæˆ‘ä»‹ç»ï¼ŒåŒ…å«"my,name,like"ç­‰é«˜é¢‘ä¸»é¢˜è¯ã€‚' },
            { id: 2, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 3, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 4, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 5, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 6, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 7, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' }
        ];

        // è·å–URLå‚æ•°
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                episode: parseInt(params.get('episode')) || 1
            };
        }

        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            const params = getUrlParams();
            const episodeId = params.episode;
            const episode = episodes.find(e => e.id === episodeId);
            
            if (!episode) {
                alert('æœªæ‰¾åˆ°è¯¥é›†æ•°');
                window.location.href = 'theater.html';
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦è§£é”
            const completedEpisodes = getCompletedEpisodes();
            const currentEpisode = getCurrentEpisode();
            const isLocked = episode.id !== currentEpisode && !completedEpisodes.includes(episode.id);
            
            if (isLocked) {
                const prevEpisode = episode.id - 1;
                alert(`è¯·å…ˆå®Œæˆç¬¬${prevEpisode}é›†æ‰èƒ½è§£é”ç¬¬${episode.id}é›†`);
                window.location.href = 'theater.html';
                return;
            }
            
            loadEpisode(episode);
            initVideoControls();
        }

        // åŠ è½½é›†æ•°
        function loadEpisode(episode) {
            const videoTitle = document.getElementById('videoTitle');
            const taskDesc = document.getElementById('taskDesc');
            const videoPlayer = document.getElementById('videoPlayer');
            
            videoTitle.textContent = `ç¬¬${episode.id}é›†ï¼š${episode.title}`;
            taskDesc.textContent = episode.task;
            
            // è®¾ç½®è§†é¢‘æºï¼ˆè¿™é‡Œä½¿ç”¨å ä½è§†é¢‘ï¼Œå®é™…ä½¿ç”¨æ—¶æ›¿æ¢ä¸ºçœŸå®è§†é¢‘URLï¼‰
            // videoPlayer.src = `videos/episode${episode.id}.mp4`;
            
            // æ¢å¤æ’­æ”¾è¿›åº¦
            const progress = getVideoProgress(episode.id);
            if (progress > 0 && progress < 100 && videoPlayer.duration) {
                videoPlayer.currentTime = (progress / 100) * videoPlayer.duration;
            }
        }

        // åˆå§‹åŒ–è§†é¢‘æ§åˆ¶
        function initVideoControls() {
            const videoPlayer = document.getElementById('videoPlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const videoProgressBar = document.getElementById('videoProgressBar');
            const videoProgressFill = document.getElementById('videoProgressFill');
            const videoProgressHandle = document.getElementById('videoProgressHandle');
            const currentTimeSpan = document.getElementById('currentTime');
            const totalTimeSpan = document.getElementById('totalTime');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const videoBack = document.getElementById('videoBack');
            
            // è¿”å›æŒ‰é’®
            videoBack.onclick = function() {
                videoPlayer.pause();
                window.location.href = 'theater.html';
            };
            
            // æ’­æ”¾/æš‚åœ
            playPauseBtn.onclick = function() {
                if (videoPlayer.paused) {
                    videoPlayer.play();
                    playPauseBtn.textContent = 'â¸';
                } else {
                    videoPlayer.pause();
                    playPauseBtn.textContent = 'â–¶';
                }
            };
            
            // è§†é¢‘æ’­æ”¾çŠ¶æ€æ›´æ–°
            videoPlayer.addEventListener('play', function() {
                playPauseBtn.textContent = 'â¸';
            });
            
            videoPlayer.addEventListener('pause', function() {
                playPauseBtn.textContent = 'â–¶';
            });
            
            // æ›´æ–°è¿›åº¦æ¡
            videoPlayer.addEventListener('timeupdate', function() {
                const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100 || 0;
                videoProgressFill.style.width = progress + '%';
                videoProgressHandle.style.left = progress + '%';
                
                currentTimeSpan.textContent = formatTime(videoPlayer.currentTime);
                
                // ä¿å­˜æ’­æ”¾è¿›åº¦
                const params = getUrlParams();
                const currentEpisode = params.episode;
                if (currentEpisode) {
                    saveVideoProgress(currentEpisode, progress);
                }
            });
            
            // è§†é¢‘åŠ è½½å®Œæˆ
            videoPlayer.addEventListener('loadedmetadata', function() {
                totalTimeSpan.textContent = formatTime(videoPlayer.duration);
                
                // æ¢å¤æ’­æ”¾è¿›åº¦
                const params = getUrlParams();
                const episodeId = params.episode;
                const progress = getVideoProgress(episodeId);
                if (progress > 0 && progress < 100) {
                    videoPlayer.currentTime = (progress / 100) * videoPlayer.duration;
                }
            });
            
            // ç‚¹å‡»è¿›åº¦æ¡è·³è½¬
            videoProgressBar.onclick = function(e) {
                const rect = videoProgressBar.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                videoPlayer.currentTime = percent * videoPlayer.duration;
            };
            
            // ä¸Šä¸€é›†
            prevBtn.onclick = function() {
                const params = getUrlParams();
                const currentEpisode = params.episode;
                if (currentEpisode && currentEpisode > 1) {
                    window.location.href = `video-player.html?episode=${currentEpisode - 1}`;
                }
            };
            
            // ä¸‹ä¸€é›†
            nextBtn.onclick = function() {
                const params = getUrlParams();
                const currentEpisode = params.episode;
                if (currentEpisode && currentEpisode < episodes.length) {
                    const nextEpisode = episodes.find(e => e.id === currentEpisode + 1);
                    if (nextEpisode) {
                        const completedEpisodes = getCompletedEpisodes();
                        const currentAvailableEpisode = getCurrentEpisode();
                        const isLocked = !completedEpisodes.includes(nextEpisode.id) && nextEpisode.id !== currentAvailableEpisode;
                        if (isLocked) {
                            let message = `è¯·å…ˆå®Œæˆç¬¬${currentEpisode}é›†æ‰èƒ½è§£é”ç¬¬${nextEpisode.id}é›†`;
                            
                            // ç¬¬4é›†åŠä»¥åéœ€è¦éš”æ—¥è§£é”
                            if (nextEpisode.id >= 4) {
                                message += `\n\næ¸©é¦¨æç¤ºï¼šä»ç¬¬4é›†å¼€å§‹ï¼Œé™¤äº†å®Œæˆä¸Šä¸€é›†ä»»åŠ¡å¤–ï¼Œéœ€è¦éš”æ—¥æ‰èƒ½è§£é”æ–°å‰§é›†å“¦ï½`;
                            }
                            
                            alert(message);
                        } else {
                            window.location.href = `video-player.html?episode=${nextEpisode.id}`;
                        }
                    }
                }
            };
            
            // è§†é¢‘æ’­æ”¾å®Œæˆ
            videoPlayer.addEventListener('ended', function() {
                // æ£€æŸ¥æ˜¯å¦å®Œæˆä»»åŠ¡ï¼ˆè¿™é‡Œæ¨¡æ‹Ÿï¼Œå®é™…åº”è¯¥ç”±æœåŠ¡ç«¯è¿”å›ï¼‰
                const params = getUrlParams();
                const episodeId = params.episode;
                checkTaskCompletion(episodeId);
            });
        }

        // æ£€æŸ¥ä»»åŠ¡å®Œæˆ
        function checkTaskCompletion(episodeId) {
            // è¿™é‡Œåº”è¯¥è°ƒç”¨æœåŠ¡ç«¯APIæ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆ
            // æ¨¡æ‹Ÿï¼šæ’­æ”¾å®Œæˆåè‡ªåŠ¨æ ‡è®°ä¸ºå®Œæˆ
            // å®é™…åº”è¯¥ï¼šæ ¹æ®æœåŠ¡ç«¯è¿”å›çš„ç»“æœæ¥åˆ¤æ–­
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            setTimeout(function() {
                // å‡è®¾æœåŠ¡ç«¯è¿”å›ä»»åŠ¡å·²å®Œæˆ
                const isCompleted = true; // å®é™…åº”è¯¥ä»æœåŠ¡ç«¯è·å–
                
                if (isCompleted) {
                    markEpisodeCompleted(episodeId);
                    alert(`æ­å–œï¼ä½ å·²å®Œæˆç¬¬${episodeId}é›†çš„ä»»åŠ¡ï¼`);
                }
            }, 500);
        }

        // æ ‡è®°é›†æ•°ä¸ºå·²å®Œæˆ
        function markEpisodeCompleted(episodeId) {
            const completed = getCompletedEpisodes();
            if (!completed.includes(episodeId)) {
                completed.push(episodeId);
                localStorage.setItem('theaterCompletedEpisodes', JSON.stringify(completed));
            }
        }

        // è·å–å·²å®Œæˆçš„é›†æ•°
        function getCompletedEpisodes() {
            const saved = localStorage.getItem('theaterCompletedEpisodes');
            return saved ? JSON.parse(saved) : [];
        }

        // è·å–å½“å‰å¯æ’­æ”¾çš„é›†æ•°
        function getCurrentEpisode() {
            const completed = getCompletedEpisodes();
            if (completed.length === 0) {
                return 1; // ç¬¬ä¸€é›†é»˜è®¤å¯æ’­æ”¾
            }
            // è¿”å›ä¸‹ä¸€é›†
            const maxCompleted = Math.max(...completed);
            return maxCompleted < episodes.length ? maxCompleted + 1 : episodes.length;
        }

        // ä¿å­˜è§†é¢‘æ’­æ”¾è¿›åº¦
        function saveVideoProgress(episodeId, progress) {
            const progressData = getVideoProgressData();
            progressData[episodeId] = progress;
            localStorage.setItem('theaterVideoProgress', JSON.stringify(progressData));
        }

        // è·å–è§†é¢‘æ’­æ”¾è¿›åº¦
        function getVideoProgress(episodeId) {
            const progressData = getVideoProgressData();
            return progressData[episodeId] || 0;
        }

        // è·å–æ‰€æœ‰è§†é¢‘æ’­æ”¾è¿›åº¦
        function getVideoProgressData() {
            const saved = localStorage.getItem('theaterVideoProgress');
            return saved ? JSON.parse(saved) : {};
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            initPage();
        });
    </script>
</body>
</html>
