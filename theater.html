<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‰§åœº - AIç©å…·å°ç¨‹åº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .phone-container {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 8px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #FFF4E6 0%, #FFF8F0 100%);
            border-radius: 32px;
            overflow: hidden;
            position: relative;
        }

        .status-bar {
            height: 44px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .content {
            padding: 20px;
            height: calc(100% - 44px - 50px);
            overflow-y: auto;
        }

        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        /* è¿›åº¦åŒºåŸŸ */
        .progress-section {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-text {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .progress-count {
            font-size: 18px;
            font-weight: bold;
            color: #FF8C42;
        }

        .progress-bar-container {
            height: 8px;
            background: #E5E5E5;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF8C42 0%, #FFA366 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-encourage {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
            text-align: center;
        }

        /* åŠ¨ç”»ç‰‡åˆ—è¡¨ */
        .episode-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .episode-card {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .episode-card:active {
            transform: scale(0.98);
        }

        .episode-card.completed {
            border-left: 4px solid #4CAF50;
        }

        .episode-card.available {
            border-left: 4px solid #FF8C42;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.2);
        }

        .episode-card.locked {
            opacity: 0.6;
            background: #F5F5F5;
        }

        .episode-number {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .episode-card.completed .episode-number {
            background: #4CAF50;
            color: #fff;
        }

        .episode-card.available .episode-number {
            background: linear-gradient(135deg, #FF8C42 0%, #FFA366 100%);
            color: #fff;
        }

        .episode-card.locked .episode-number {
            background: #E0E0E0;
            color: #999;
        }

        .episode-info {
            flex: 1;
            min-width: 0;
        }

        .episode-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .episode-card.locked .episode-title {
            color: #999;
        }

        .episode-task {
            font-size: 13px;
            color: #666;
            margin-bottom: 6px;
        }

        .episode-card.locked .episode-task {
            color: #999;
        }

        .episode-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .status-badge.completed {
            background: #E8F5E9;
            color: #4CAF50;
        }

        .status-badge.available {
            background: #E3F2FD;
            color: #FF8C42;
        }

        .status-badge.locked {
            background: #F5F5F5;
            color: #999;
        }

        .episode-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        /* æ›´æ–°æç¤ºå¡ç‰‡ */
        .update-card {
            background: linear-gradient(135deg, #FFE5CC 0%, #FFF0E0 100%);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 2px 10px rgba(74, 144, 226, 0.1);
            border: 2px dashed #FF8C42;
            min-height: 120px;
        }

        .update-card-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .update-card-title {
            font-size: 16px;
            font-weight: 500;
            color: #FF8C42;
            margin-bottom: 6px;
        }

        .update-card-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .task-info {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .task-info-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .task-info-desc {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            line-height: 1.5;
        }

        .nav-bar {
            height: 50px;
            background: #fff;
            border-top: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px 0;
            color: #999;
            cursor: pointer;
        }

        .nav-item.active {
            color: #FF8C42;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
            background: currentColor;
            border-radius: 4px;
        }

        .nav-text {
            font-size: 11px;
        }

        /* ç¡çœ çŠ¶æ€æ ·å¼ */
        .sleep-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 200px);
            min-height: 400px;
        }

        .sleep-icon {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #FF8C42 0%, #FFA366 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
            margin-bottom: 30px;
            opacity: 0.6;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .sleep-text {
            font-size: 16px;
            color: #666;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="screen">
            <div class="status-bar">
                <span>9:41</span>
                <span>ğŸ”‹ 100%</span>
            </div>
            
            <div class="content">
                <div class="page-title">å‰§åœº</div>

                <!-- è¿›åº¦åŒºåŸŸ -->
                <div class="progress-section">
                    <div class="progress-header">
                        <div class="progress-text">è§‚çœ‹è¿›åº¦</div>
                        <div class="progress-count" id="progressCount">0/7</div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                    <div class="progress-encourage" id="progressEncourage">ğŸ¬ è‹±æ–‡å°å‰§åœºæŒç»­æ›´æ–°ä¸­ï¼Œæ•¬è¯·æœŸå¾…æ›´å¤šç²¾å½©å†…å®¹</div>
                </div>

                <!-- åŠ¨ç”»ç‰‡åˆ—è¡¨ -->
                <div class="episode-list" id="episodeList">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>


            <div class="nav-bar">
                <div class="nav-item" onclick="window.location.href='pairing-set.html'">
                    <div class="nav-icon"></div>
                    <div class="nav-text">ä¼™ä¼´</div>
                </div>
                <div class="nav-item active">
                    <div class="nav-icon"></div>
                    <div class="nav-text">å‰§åœº</div>
                </div>
                <div class="nav-item" onclick="window.location.href='growth.html'">
                    <div class="nav-icon"></div>
                    <div class="nav-text">æˆé•¿</div>
                </div>
                <div class="nav-item" onclick="window.location.href='mine.html'">
                    <div class="nav-icon"></div>
                    <div class="nav-text">æˆ‘çš„</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åŠ¨ç”»ç‰‡æ•°æ®
        const episodes = [
            { id: 1, title: 'ä¸æ˜Ÿå®ç›¸è¯†', task: 'ä»»åŠ¡è¯´æ˜ï¼šç”¨è‹±æ–‡åšè‡ªæˆ‘ä»‹ç»ï¼ŒåŒ…å«"my,name,like"ç­‰é«˜é¢‘ä¸»é¢˜è¯ã€‚' },
            { id: 2, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 3, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 4, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 5, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 6, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' },
            { id: 7, title: 'ä»»åŠ¡åç§°å¾…å®š', task: 'ä»»åŠ¡æè¿°å¾…å®š' }
        ];

        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            renderEpisodes();
            updateProgress();
        }

        // æ¸²æŸ“åŠ¨ç”»ç‰‡åˆ—è¡¨
        function renderEpisodes() {
            const episodeList = document.getElementById('episodeList');
            const completedEpisodes = getCompletedEpisodes();
            const currentEpisode = getCurrentEpisode();
            
            const episodesHtml = episodes.map((episode, index) => {
                const isCompleted = completedEpisodes.includes(episode.id);
                const isAvailable = episode.id === currentEpisode || isCompleted;
                const isLocked = !isAvailable;
                
                let statusClass = 'locked';
                let statusBadge = '<span class="status-badge locked">ğŸ”’ å·²é”å®š</span>';
                let statusIcon = 'ğŸ”’';
                
                if (isCompleted) {
                    statusClass = 'completed';
                    statusBadge = '<span class="status-badge completed">âœ“ å·²å®Œæˆ</span>';
                    statusIcon = 'âœ“';
                } else if (isAvailable) {
                    statusClass = 'available';
                    statusBadge = '<span class="status-badge available">ğŸ¬ å¼€å§‹æ’­æ”¾</span>';
                    statusIcon = 'â–¶';
                }
                
                return `
                    <div class="episode-card ${statusClass}" onclick="handleEpisodeClick(${episode.id}, ${isLocked})">
                        <div class="episode-number">${episode.id}</div>
                        <div class="episode-info">
                            <div class="episode-title">ç¬¬${episode.id}é›†ï¼š${episode.title}</div>
                            <div class="episode-task">${episode.task}</div>
                        </div>
                        <div class="episode-icon">${statusIcon}</div>
                    </div>
                `;
            }).join('');
            
            // æ·»åŠ æ›´æ–°æç¤ºå¡ç‰‡
            const updateCardHtml = `
                <div class="update-card">
                    <div class="update-card-icon">ğŸ¬</div>
                    <div class="update-card-title">æ›´å¤šç²¾å½©å‰§é›†å³å°†ä¸Šçº¿</div>
                    <div class="update-card-desc">å‰§åœºæŒç»­æ›´æ–°ä¸­ï¼Œæ•¬è¯·æœŸå¾…</div>
                </div>
            `;
            
            episodeList.innerHTML = episodesHtml + updateCardHtml;
        }

        // å¤„ç†é›†æ•°ç‚¹å‡»
        function handleEpisodeClick(episodeId, isLocked) {
            if (isLocked) {
                const prevEpisode = episodeId - 1;
                let message = `è¯·å…ˆå®Œæˆç¬¬${prevEpisode}é›†æ‰èƒ½è§£é”ç¬¬${episodeId}é›†`;
                
                // ç¬¬4é›†åŠä»¥åéœ€è¦éš”æ—¥è§£é”
                if (episodeId >= 4) {
                    message += `\n\næ¸©é¦¨æç¤ºï¼šä»ç¬¬4é›†å¼€å§‹ï¼Œé™¤äº†å®Œæˆä¸Šä¸€é›†ä»»åŠ¡å¤–ï¼Œéœ€è¦éš”æ—¥æ‰èƒ½è§£é”æ–°å‰§é›†å“¦ï½`;
                }
                
                alert(message);
                return;
            }
            
            // è·³è½¬åˆ°è§†é¢‘æ’­æ”¾é¡µé¢
            window.location.href = `video-player.html?episode=${episodeId}`;
        }

        // æ ‡è®°é›†æ•°ä¸ºå·²å®Œæˆï¼ˆä¾›è§†é¢‘æ’­æ”¾é¡µé¢è°ƒç”¨ååˆ·æ–°ï¼‰
        function markEpisodeCompleted(episodeId) {
            const completed = getCompletedEpisodes();
            if (!completed.includes(episodeId)) {
                completed.push(episodeId);
                localStorage.setItem('theaterCompletedEpisodes', JSON.stringify(completed));
                renderEpisodes();
                updateProgress();
            }
        }

        // è·å–å·²å®Œæˆçš„é›†æ•°
        function getCompletedEpisodes() {
            const saved = localStorage.getItem('theaterCompletedEpisodes');
            return saved ? JSON.parse(saved) : [];
        }

        // è·å–å½“å‰å¯æ’­æ”¾çš„é›†æ•°
        function getCurrentEpisode() {
            const completed = getCompletedEpisodes();
            if (completed.length === 0) {
                return 1; // ç¬¬ä¸€é›†é»˜è®¤å¯æ’­æ”¾
            }
            // è¿”å›ä¸‹ä¸€é›†
            const maxCompleted = Math.max(...completed);
            return maxCompleted < episodes.length ? maxCompleted + 1 : episodes.length;
        }


        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            const completed = getCompletedEpisodes();
            const count = completed.length;
            const total = episodes.length;
            const percent = (count / total) * 100;
            
            document.getElementById('progressCount').textContent = `${count}/${total}`;
            document.getElementById('progressBar').style.width = percent + '%';
            
            // æ›´æ–°é¼“åŠ±æ–‡æ¡ˆ
            const encourageTexts = [
                'ğŸ¬ è‹±æ–‡å°å‰§åœºæŒç»­æ›´æ–°ä¸­ï¼Œæ•¬è¯·æœŸå¾…æ›´å¤šç²¾å½©å†…å®¹',
                'ç»§ç»­åŠ æ²¹ï¼Œå®Œæˆæ›´å¤šä»»åŠ¡ï¼',
                'å¤ªæ£’äº†ï¼Œä½ å·²ç»å®Œæˆäº†ä¸€åŠï¼',
                'åšæŒå°±æ˜¯èƒœåˆ©ï¼',
                'ä½ åšå¾—å¾ˆå¥½ï¼Œç»§ç»­åŠªåŠ›ï¼',
                'é©¬ä¸Šå°±è¦å®Œæˆäº†ï¼',
                'æ­å–œä½ å®Œæˆäº†æ‰€æœ‰ä»»åŠ¡ï¼'
            ];
            const encourageIndex = Math.min(count, encourageTexts.length - 1);
            document.getElementById('progressEncourage').textContent = encourageTexts[encourageIndex];
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // æ£€æŸ¥è®¾å¤‡ç»‘å®šçŠ¶æ€
        function checkDevicePaired() {
            const isPaired = localStorage.getItem('devicePaired') === 'true';
            if (!isPaired) {
                // æ˜¾ç¤ºç¡çœ çŠ¶æ€
                document.querySelector('.content').innerHTML = `
                    <div class="sleep-container">
                        <div class="sleep-icon">ğŸ˜´</div>
                        <div class="sleep-text">è¯·å…ˆç»‘å®šè®¾å¤‡</div>
                    </div>
                `;
                return false;
            }
            return true;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            if (checkDevicePaired()) {
                initPage();
            }
        });
        
        // é¡µé¢æ˜¾ç¤ºæ—¶åˆ·æ–°ï¼ˆä»è§†é¢‘æ’­æ”¾é¡µé¢è¿”å›æ—¶ï¼‰
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                renderEpisodes();
                updateProgress();
            }
        });
    </script>
</body>
</html>